var grabbed_json="nothing";$(document).ready(function(){var o="/actions/file_uploader.php";""!==uploadScriptPath&&(o=uploadScriptPath);var a=(a=back_extensions).substring(0,a.length-1);$.get(theme+"/js/plupload/js/plupload.full.min.js",function(e){var i=new plupload.Uploader({browse_button:"selectFiles",dragdrop:!0,drop_element:"dragDrop",runtimes:"html5,flash,silverlight,html4",url:o,file_data_name:"Filedata",filters:{mime_types:[{title:"Video files",extensions:a}],max_file_size:max_upload_size+"Mb"}});function l(s){var d=document.createElement("ul"),o=(d.id="selectedFilesList",!(d.className="nav nav-tabs")),i=1,l=$("#updateVideoInfoForm.template").clone(),r=!1,c=[];plupload.each(s.files,function(e){o=document.createElement("li"),i===s.files.length?o.className="active":o.className="";var a=document.createElement("a"),t=(a.href="#tab"+i,a.setAttribute("data-toggle","tab"),s.files.length<8?a.innerHTML="("+i+") "+e.name.substring(0,10):a.innerHTML="("+i+") ",(r=$(l).clone().get(0)).className="updateVideoInfoForm",r.id="",document.createElement("div")),n=(t.id="tab"+i,i===s.files.length?t.className="tab-pane active uploadFormContainer":t.className="tab-pane uploadFormContainer",$(r).find(".cancel_button").attr("to_cancel",i),$(r).find("input[name='title']").val(e.data.title),$(r).find("textarea[name='description']").val(e.data.description),$(r).find("input[name='tags']").val(e.data.tags).attr("id","tags"+i),$(r).find("input[name='location']").val(e.data.location),$(r).find("input[name='datecreated']").val(e.data.datecreated),$(r).find("input[name='video_password']").val(e.data.video_password),$(r).find("select[name='country']").val(e.data.country),$(r).find("textarea[name='video_users']").val(e.data.video_users),$(r).find("input[name='broadcast'][value='"+e.data.broadcast+"']").prop("checked",!0),$(r).find("input[name='allow_comments'][value='"+e.data.allow_comments+"']").prop("checked",!0),$(r).find("input[name='comment_voting'][value='"+e.data.comment_voting+"']").prop("checked",!0),$(r).find("input[name='allow_rating'][value='"+e.data.allow_rating+"']").prop("checked",!0),$(r).find("input[name='allow_embedding'][value='"+e.data.allow_embedding+"']").prop("checked",!0),document.createElement("ul"));n.id="list_tags_"+i,$(n).insertAfter($(r).find("input[name='tags']")),$(r).find("#list_tags_"+i).tagit({singleField:!0,readOnly:!1,singleFieldNode:$(r).find("#tags"+i),animate:!0}),"unlisted"===e.data.broadcast?$(r).find("#video_password").attr("disabled",!1):"private"===e.data.broadcast&&$(r).find("#video_users").attr("disabled",!1),$.each(e.data["category[]"],function(e,a){$(r).find("input[name='category[]'][value='"+a+"']").prop("checked",!0)}),!0===e.show_duration&&$(r).find("#duration").removeClass("hidden").removeAttr("disabled"),100===e.percent&&$(r).find(".saveVideoDetails").removeAttr("disabled"),t.appendChild(r),c.push(t),o.id=i++,o.appendChild(a),d.appendChild(o)}),$("#files").html("").append(d),$("#allUploadForms").html("").append(c),$("#allUploadForms input, #allUploadForms textarea, #allUploadForms select ").change(function(){var a,t=$(this).closest("form").find("input[name='file_name']").val(),n=$(this).attr("name");"checkbox"!==$(this).attr("type")?a=$(this).val():(a=[],$.each($(this).closest("form").find("input[name='"+n+"']:checked"),function(){a.push($(this).val())})),plupload.each(s.files,function(e){e.file_name===t&&(e.data[n]=a)})})}i.init(),i.bind("FilesRemoved",function(e){l(e)}),i.bind("FilesAdded",function(e,s){$("#uploadMore").addClass("hidden");var a=s[0].name;let t=a.substring(0,a.lastIndexOf("."));t.length>max_video_title&&(t=t.substring(0,max_video_title)),s[0].data=[],s[0].data.title=t,s[0].data.description=t,s[0].data.tags=t,s[0].data.country=default_country_iso2,s[0].data.location="",s[0].data.datecreated=date_format_time,s[0].data.broadcast="",s[0].data.video_password="",s[0].data.video_users="",s[0].data.allow_comments="yes",s[0].data.comment_voting="yes",s[0].data.allow_rating="yes",s[0].data.allow_embedding="yes",s[0].data["category[]"]=[get_default_cid],l(e),$.each(s,function(e,a){var t=a.name,a=a.id;$(".realProgressBars").append('<h5 class="realProgTitle_'+a+'">'+t+'</h5><button class="clearfix cancel_button btn btn-danger" to_cancel="'+a+'" style="float:right; margin-top: -8px; margin-left:10px;">Cancel Uploading</button><div class="progress"><div class="progress-bar progress-bar_'+a+'" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:0%;"><span class="sr-only">70% Complete</span><span class="realProgText_'+a+'">50% completed</span></div></div>')});for(var n,d=1,o=0;o<e.files.length;o++)void 0!==e.files[o].file_name&&((n=document.createElement("input")).name="file_name",n.type="hidden",n.value=e.files[o].file_name,$("#tab"+d+" form").append(n)),!0===e.files[o].show_duration&&$("#tab"+d+" #duration").removeClass("hidden").removeAttr("disabled"),e.files[o].percent<100&&$("#tab"+d+" .saveVideoDetails").attr("disabled",!0),d++;$(".formSection h4").on({click:function(e){e.preventDefault(),$(this).find("i").hasClass("glyphicon-chevron-down")?$(this).find("i").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up"):$(this).find("i").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down"),$(this).next().toggleClass("hidden")}}),$(".cancel_button").on("click",function(e){e.preventDefault();var t=$(this).attr("to_cancel"),n=0;$(this).attr("disabled",!0),$(this).text("Canceled"),$.each(s,function(e,a){a.id===t&&(i.removeFile(s[n]),$(this).unbind().remove(),$(".progress-bar_"+t).addClass("progress-bar-danger"),$(".realProgText_"+t).text("Canceled"),$("#uploadMessage").removeClass("hidden").html("Upload has been canceled").attr("class","alert alert-danger container"),setTimeout(function(){$("#uploadMessage").addClass("hidden")},5e3)),n++})}),setTimeout(function(){$("#uploaderContainer").toggleClass("hidden"),$("#uploadDataContainer").toggleClass("hidden"),$(".uploadingProgressContainer").show(),$(".allProgress").removeClass("hidden"),i.start()},1e3)}),i.bind("BeforeUpload",function(){$("#fileUploadProgress").removeClass("hidden"),$(".progress-container").removeClass("hidden")});var d=0;i.bind("FileUploaded",function(e,t,a){$("#overallProgress").css("width",100/e.files.length*++d+"%"),$("#overallProgress").parents(".row").find("#uploadedFilesInfo").text("Inserted "+d+" of "+e.files.length);var n=$.parseJSON(a.response),s=1;plupload.each(e.files,function(e){var a;e.id===t.id&&(e.file_name=n.file_name,(a=document.createElement("input")).name="file_name",a.type="hidden",a.value=n.file_name,$("#tab"+s+" form").append(a),"mp4"===n.extension&&"yes"===stay_mp4?(e.show_duration=!0,$("#tab"+s+" #duration").removeClass("hidden").removeAttr("disabled")):e.show_duration=!1,$("#tab"+s+" .saveVideoDetails").removeAttr("disabled")),s++}),$(".updateVideoInfoForm").on({submit:function(e){e.preventDefault();e=$(this).serialize();e+="&updateVideo=yes",$.ajax({url:o,type:"post",data:e,success:function(e){e=$.parseJSON(e),$("#uploadMessage").removeClass("hidden"),e.error?$("#uploadMessage").html(e.error.val).attr("class","alert alert-danger container"):($("#uploadMessage").html(e.valid).attr("class","alert alert-success container"),$("#tab"+s+" .saveVideoDetails").attr("disabled",!0),setTimeout(function(){$("#uploadMessage").addClass("hidden")},4e3)),$("html,body").animate({scrollTop:$("body").offset().top},"medium")}}).fail(function(e){console.log(e)})}})}),i.bind("UploadProgress",function(e,a){var t=a.id,a=a.percent;$(".progress-bar_"+t).css("width",a+"%"),$(".realProgText_"+t).text(a+"% Completed"),100===a&&($(".cancel_button[to_cancel='"+t+"']").fadeOut("slow"),$(".progress-bar_"+t).addClass("progress-bar-success"))}),i.bind("UploadComplete",function(e,a){$("#fileUploadProgress").addClass("hidden"),$("#uploadMore").removeClass("hidden"),$(".uploadingProgressContainer").hide(),i.refresh(),$("#uploadMessage").html("File uploaded successfully").attr("class","alert alert-success container"),setTimeout(function(){$("#uploadMessage").addClass("hidden")},5e3)}),i.bind("error",function(e,a){$("#uploadMessage").removeClass("hidden"),a&&$("#uploadMessage").html(a.message).attr("class","alert alert-danger container"),setTimeout(function(){$("#uploadMessage").addClass("hidden")},8e3)}),$("#files a").click(function(e){e.preventDefault(),$(this).tab("show")}),$("#uploadMoreVideos").on({click:function(e){e.preventDefault(),$("#uploaderContainer").removeClass("hidden"),$("#uploadDataContainer").addClass("hidden")}})}),window.onbeforeunload=function(){return!0===$(".uploadingProgressContainer").is(":visible")?"Uploading is in progress, are you sure you want to navigate away from this page?":null},$(document).on("click","#youtube_update",function(e){e.preventDefault(),$(document).find(".__theClassHere").find("form").attr("id","youtube_update_form");e=$("#youtube_update_form").serialize();e+="&updateVideo=yes&videoid="+grabbed_json.vid,$.ajax({url:o,type:"post",data:e,success:function(e){$("#uploadMessage").removeClass("hidden"),(e=$.parseJSON(e)).error?$("#uploadMessage").html(e.error).attr("class","alert alert-danger container"):$("#uploadMessage").html(e.msg).attr("class","alert alert-success container"),setTimeout(function(){$("#uploadMessage").addClass("hidden")},5e3)}}).fail(function(e){console.log(e)})})});