var uploader,grabbed_json="nothing";function getInfoTmdb(e,a,t,n,d,i){showSpinner(),$.ajax({url:"/actions/info_tmdb.php",type:"POST",data:{videoid:e,video_title:a,page:t,sort:n,sort_order:d},dataType:"json",success:function(e){hideSpinner();var a=$("#myModal");a.html(e.template),a.modal(),$(".page-content").prepend(e.msg)}})}function saveInfoTmdb(e,a){showSpinner(),$.ajax({url:"/actions/import_tmdb.php",type:"POST",data:{tmdb_video_id:e,videoid:a},dataType:"json",success:function(e){var d;$(".close").click(),hideSpinner(),0==e.success?$(".page-content").prepend(e.msg):(d=1,plupload.each(uploader.files,function(n){n.file_name===e.video_detail.file_name&&$.each(e.video_detail,function(e,a){n.data[e]=a;var t=$("#tab"+d).find('[name="'+e+'"]').first();0<t.length&&(e.includes("tag")?(e=a.split(","),$.each(e,function(e,a){""!==a&&t.parent().find("ul").first().tagit("createTag",a)})):t.val(a))}),d++}))}})}function pageInfoTmdb(e,a){let t,n;0<$(".icon-sort-up").length?(t=$(".icon-sort-up").data("type"),n="ASC"):0<$(".icon-sort-down").length&&(t=$(".icon-sort-down").data("type"),n="DESC"),getInfoTmdb(a,$("#search_title").val(),e,t,n)}function showSpinner(){$(".taskHandler").show()}function hideSpinner(){$(".taskHandler").hide()}$(document).ready(function(){var r="/actions/file_uploader.php";""!==uploadScriptPath&&(r=uploadScriptPath);var a=(a=back_extensions).substring(0,a.length-1);$.get(theme+"/js/plupload/js/plupload.full.min.js",function(e){function o(d){var t=$("#selectedFilesList"),i=!1,o=0,s=$("#updateVideoInfoForm.template").clone(),l=!1,r=[];plupload.each(d.files,function(n){var e,a;o++,0!==$("#tab"+o).length?(t.find("#"+o).removeClass("active"),$("#tab"+o).removeClass("active")):(i=document.createElement("li"),(e=document.createElement("a")).href="#tab"+o,e.setAttribute("data-toggle","tab"),d.files.length<8?e.innerHTML="("+o+") "+n.name.substring(0,10):e.innerHTML="("+o+") ",(l=$(s).clone().get(0)).className="updateVideoInfoForm",l.id="",(a=document.createElement("div")).id="tab"+o,o===d.files.length?(i.className="active",a.className="tab-pane active uploadFormContainer"):a.className="tab-pane uploadFormContainer",$(l).find(".cancel_button").attr("to_cancel",o),$(l).find("input[name='title']").val(n.data.title),$(l).find("textarea[name='description']").val(n.data.description),$(l).find("input[name='location']").val(n.data.location),$(l).find("input[name='datecreated']").val(n.data.datecreated),$(l).find("input[name='video_password']").val(n.data.video_password),$(l).find("select[name='country']").val(n.data.country),$(l).find("textarea[name='video_users']").val(n.data.video_users),$(l).find("input[name='broadcast'][value='"+n.data.broadcast+"']").prop("checked",!0),$(l).find("input[name='allow_comments'][value='"+n.data.allow_comments+"']").prop("checked",!0),$(l).find("input[name='comment_voting'][value='"+n.data.comment_voting+"']").prop("checked",!0),$(l).find("input[name='allow_rating'][value='"+n.data.allow_rating+"']").prop("checked",!0),$(l).find("input[name='allow_embedding'][value='"+n.data.allow_embedding+"']").prop("checked",!0),$(l).find("[id^=tags]").each(function(e){var a=document.createElement("ul"),t=(a.id="list_"+this.id+"_"+o,$(this).val(n.data[this.name]).attr("id",this.name+o),$(a).insertAfter($(l).find("input[name='"+this.name+"']")),!1);$(l).find("#"+a.id).tagit({singleField:!0,readOnly:!1,singleFieldNode:$(l).find("#"+this.id),animate:!0,caseSensitive:!1,availableTags:available_tags,beforeTagAdded:function(e,a){if(a.tagLabel.length<=2)return t||(t=!0,alert(tag_too_short)),!1;t=!1}})}),$(l).find("#button_info_tmdb").on("click",function(){getInfoTmdb($(l).find("#videoid_"+o).val(),n.data.title,1)}),"unlisted"===n.data.broadcast?$(l).find("#video_password").attr("disabled",!1):"private"===n.data.broadcast&&$(l).find("#video_users").attr("disabled",!1),$.each(n.data["category[]"],function(e,a){$(l).find("input[name='category[]'][value='"+a+"']").prop("checked",!0)}),!0===n.show_duration&&$(l).find("#duration").removeClass("hidden").removeAttr("disabled"),100===n.percent&&$(l).find(".saveVideoDetails").removeAttr("disabled"),a.appendChild(l),r.push(a),i.id=o,i.appendChild(e),t.append(i))}),$("#allUploadForms").append(r),$("#allUploadForms input, #allUploadForms textarea, #allUploadForms select ").change(function(){var a,t=$(this).closest("form").find("input[name='file_name']").val(),n=$(this).attr("name");"checkbox"!==$(this).attr("type")?a=$(this).val():(a=[],$.each($(this).closest("form").find("input[name='"+n+"']:checked"),function(){a.push($(this).val())})),plupload.each(d.files,function(e){e.file_name===t&&(e.data[n]=a)})})}(uploader=new plupload.Uploader({browse_button:"selectFiles",dragdrop:!0,drop_element:"dragDrop",runtimes:"html5,flash,silverlight,html4",url:r,file_data_name:"Filedata",filters:{mime_types:[{title:"Video files",extensions:a}],max_file_size:max_upload_size+"Mb"}})).init(),uploader.bind("FilesRemoved",function(e){o(e)}),uploader.bind("FilesAdded",function(e,d){let a;for($("#uploadMore").addClass("hidden"),a=0;a<d.length;a++){var t=d[a].name;let e=t.substring(0,t.lastIndexOf("."));e.length>max_video_title&&(e=e.substring(0,max_video_title)),d[a].data=[],d[a].data.title=e,d[a].data.description=e,d[a].data.tags="",d[a].data.country=default_country_iso2,d[a].data.location="",d[a].data.datecreated=date_format_time,d[a].data.broadcast="",d[a].data.video_password="",d[a].data.video_users="",d[a].data.allow_comments="yes",d[a].data.comment_voting="yes",d[a].data.allow_rating="yes",d[a].data.allow_embedding="yes",d[a].data["category[]"]=[get_default_cid]}o(e),$.each(d,function(e,a){var t=a.name,a=a.id;$(".realProgressBars").append('<h5 class="realProgTitle_'+a+'">'+t+'</h5><button class="clearfix cancel_button btn btn-danger" to_cancel="'+a+'" style="float:right; margin-top: -8px; margin-left:10px;">Cancel Uploading</button><div class="progress"><div class="progress-bar progress-bar_'+a+'" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:0%;"><span class="sr-only">70% Complete</span><span class="realProgText_'+a+'">50% completed</span></div></div>')});var n,i=1;for(a=0;a<e.files.length;a++)void 0!==e.files[a].file_name&&((n=document.createElement("input")).name="file_name",n.type="hidden",n.value=e.files[a].file_name,$("#tab"+i+" form").append(n)),!0===e.files[a].show_duration&&$("#tab"+i+" #duration").removeClass("hidden").removeAttr("disabled"),e.files[a].percent<100&&$("#tab"+i+" .saveVideoDetails").attr("disabled",!0),i++;$(".formSection h4").on({click:function(e){e.preventDefault(),$(this).find("i").hasClass("glyphicon-chevron-down")?$(this).find("i").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up"):$(this).find("i").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down"),$(this).next().toggleClass("hidden")}}),$(".cancel_button").on("click",function(e){e.preventDefault();var t=$(this).attr("to_cancel"),n=0;$(this).attr("disabled",!0),$(this).text("Canceled"),$.each(d,function(e,a){a.id===t&&(uploader.removeFile(d[n]),$(this).unbind().remove(),$(".progress-bar_"+t).addClass("progress-bar-danger"),$(".realProgText_"+t).text("Canceled"),$("#uploadMessage").removeClass("hidden").html("Upload has been canceled").attr("class","alert alert-danger container"),setTimeout(function(){$("#uploadMessage").addClass("hidden")},5e3)),n++})}),setTimeout(function(){$("#uploaderContainer").toggleClass("hidden"),$("#uploadDataContainer").toggleClass("hidden"),$(".uploadingProgressContainer").show(),$(".allProgress").removeClass("hidden"),uploader.start()},1e3)}),uploader.bind("BeforeUpload",function(){$("#fileUploadProgress").removeClass("hidden"),$(".progress-container").removeClass("hidden")});var s=0,l=[];uploader.bind("FileUploaded",function(e,t,a){var n=$.parseJSON(a.response),d="",i=(n.error?(l.push(n.error),$(".progress-bar_"+t.id).addClass("progress-bar-danger"),d=t.id):s++,$("#overallProgress").css("width",100/e.files.length*s+"%"),$("#overallProgress").parents(".row").find("#uploadedFilesInfo").text("Inserted "+s+" of "+e.files.length),1);plupload.each(e.files,function(e){var a;e.id===t.id&&(d===e.id?$("#tab"+i+" form").find(":input").attr("disabled","disabled"):(e.file_name=n.file_name,(a=document.createElement("input")).name="file_name",a.id="file_name_"+i,a.type="hidden",a.value=n.file_name,$("#tab"+i+" form").append(a),(a=document.createElement("input")).name="videoid",a.id="videoid_"+i,a.type="hidden",a.value=n.videoid,0===$("#"+a.id).length&&$("#tab"+i+" form").append(a),"mp4"===n.extension&&"yes"===stay_mp4?(e.show_duration=!0,$("#tab"+i+" #duration").removeClass("hidden").removeAttr("disabled")):e.show_duration=!1,$("#tab"+i+" .saveVideoDetails").removeAttr("disabled"))),i++}),$(".updateVideoInfoForm").on({submit:function(e){e.preventDefault();e=$(this).serialize();e+="&updateVideo=yes",$.ajax({url:r,type:"post",data:e,success:function(e){e=$.parseJSON(e),$("#uploadMessage").removeClass("hidden"),e.error?$("#uploadMessage").html(e.error.val).attr("class","alert alert-danger container"):($("#uploadMessage").html(e.valid).attr("class","alert alert-success container"),$("#tab"+i+" .saveVideoDetails").attr("disabled",!0),setTimeout(function(){$("#uploadMessage").addClass("hidden")},4e3)),$("html,body").animate({scrollTop:$("body").offset().top},"medium")}}).fail(function(e){console.log(e)})}})}),uploader.bind("UploadProgress",function(e,a){var t=a.id,a=a.percent;$(".progress-bar_"+t).css("width",a+"%"),$(".realProgText_"+t).text(a+"% Completed"),100===a&&($(".cancel_button[to_cancel='"+t+"']").fadeOut("slow"),$(".progress-bar_"+t).hasClass("progress-bar-danger")||$(".progress-bar_"+t).addClass("progress-bar-success"))}),uploader.bind("UploadComplete",function(e,a){$("#fileUploadProgress").addClass("hidden"),$("#uploadMore").removeClass("hidden"),$(".uploadingProgressContainer").hide(),uploader.refresh(),0<l.length?($("#uploadMessage").html(""),l.forEach(function(e){$("#uploadMessage").append(e).attr("class","alert alert-danger container")}),l=[]):($("#uploadMessage").html("File uploaded successfully").attr("class","alert alert-success container"),setTimeout(function(){$("#uploadMessage").addClass("hidden")},5e3))}),uploader.bind("error",function(e,a){$("#uploadMessage").removeClass("hidden"),a&&$("#uploadMessage").html(a.message).attr("class","alert alert-danger container"),setTimeout(function(){$("#uploadMessage").addClass("hidden")},8e3)}),$("#files a").click(function(e){e.preventDefault(),$(this).tab("show")}),$("#uploadMoreVideos").on({click:function(e){e.preventDefault(),$("#uploaderContainer").removeClass("hidden"),$("#uploadDataContainer").addClass("hidden")}})}),window.onbeforeunload=function(){return!0===$(".uploadingProgressContainer").is(":visible")?"Uploading is in progress, are you sure you want to navigate away from this page?":null}});