var inputs=document.querySelectorAll("#mfa_code input"),modalElement=document.getElementById("enterMFACodeModal"),confirmButton=document.getElementById("confirmMFACodeBtn"),closeModalButton=document.querySelector(".close");function closeModal(){modalElement.classList.remove("in"),modalElement.style.display="none",modalElement.setAttribute("aria-hidden","true"),document.body.classList.remove("modal-open");var e=document.querySelector(".modal-backdrop");e&&e.remove()}function showModal(){modalElement.classList.add("in"),modalElement.style.display="block",modalElement.setAttribute("aria-hidden","false"),document.body.classList.add("modal-open");var e=document.createElement("div");e.className="modal-backdrop fade in",document.body.appendChild(e),modalElement.querySelectorAll('[data-dismiss="modal"]').forEach(function(e){e.addEventListener("click",closeModal)})}function insertHTMLAfter(e,t){var n=document.createRange(),n=(n.setStartAfter(e),n.createContextualFragment(t));e.parentNode.insertBefore(n,e.nextSibling)}function insertHTMLBefore(e,t){var n=document.createRange(),n=(n.setStartBefore(e),n.createContextualFragment(t));e.parentNode.insertBefore(n,e)}need_mfa=!1,document.addEventListener("DOMContentLoaded",function(){inputs=document.querySelectorAll("#mfa_code input"),modalElement=document.getElementById("enterMFACodeModal"),confirmButton=document.getElementById("confirmMFACodeBtn"),closeModalButton=document.querySelector(".close");const e=document.querySelector('form[name="login_form"]');e.addEventListener("submit",function(e){e.preventDefault(),showSpinner();var e=document.getElementById("login_username_sp").value,t=document.getElementById("login_password_sp").value,n=document.getElementById("remember_me").value;if(""===e||""===t)return alert(lang.please_fill_all_fields),hideSpinner(),!1;let o="";if("undefined"!=typeof need_mfa&&need_mfa){if(!1===modalElement.classList.contains("in"))return showModal(),hideSpinner(),!1;if(inputs.forEach(e=>{o+=e.value}),""===o.trim())return alert(lang.please_enter_mfa_code),hideSpinner(),!1;if(6!==o.length)return alert(lang.please_enter_6_digit_mfa_code),hideSpinner(),!1}fetch(baseurl+"actions/login.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({username:e,password:t,mfa_code:o,remember_me:n})}).then(e=>e.json()).then(e=>{var t;e.need_mfa?(showModal(),"email"===(need_mfa=e.need_mfa)&&(document.getElementById("email_mfa_hint").style.display="block"),hideSpinner()):e.success&&(closeModalButton.click(),window.location.href=e.redirect),need_mfa?(t=document.querySelector("#enterMFACodeModal > div > div > div.modal-body > .form-group"))&&insertHTMLAfter(t,e.msg):(t=document.querySelector(".account-holder"))&&insertHTMLBefore(t,e.msg),hideSpinner()}).catch(e=>{console.error("Login error:",e),alert("An error occurred")})}),confirmButton&&confirmButton.addEventListener("click",function(){e.requestSubmit()}),closeModalButton.addEventListener("click",function(){closeModal()}),inputs.forEach((t,n)=>{t.addEventListener("input",()=>{1===t.value.length&&n<inputs.length-1&&inputs[n+1].focus()}),t.addEventListener("keydown",e=>{"Backspace"===e.key&&""===t.value&&0<n&&inputs[n-1].focus()}),t.addEventListener("paste",e=>{e.preventDefault();var t=e.clipboardData.getData("text");for(let e=0;e<inputs.length;e++)inputs[e].value=t[e]||"";e=Math.min(t.length,inputs.length)-1;0<=e&&inputs[e].focus()})})});