var visual_editors={};function get_the_comment(e,t,o){$.post(page,{mode:"get_comment",cid:e,type_id:t},function(t){if(t){if(t.parent_id)$(".reply-box-"+t.parent_id).hide(),$(".comments-reply-"+t.parent_id).append(t.li_data).slideDown(),$("html, body").animate({scrollTop:$("#reply-"+e).offset().top},1e3),comment_transition(".reply-",e);else{if($(t.li_data).hide().prependTo(o),visual_editor_comments_enabled){let n=document.querySelectorAll(o+" p")[0];new toastui.Editor.factory({el:n,viewer:!0,usageStatistics:!1,initialValue:n.innerHTML})}$(o).children().first().slideDown("slow")}}else alert("No data");clear_comment_form()},"json")}function add_comment_js(e){$("#add_comment_result").css("display","block"),$("#add_comment_button").val(lang_loading),$("#add_comment_button").attr("disabled",!0),$(".add-reply").attr("disabled",!0);var t=$("#"+e).serialize()+"&mode=add_comment";$.post(page,t,function(t){if(t){if($("#add_comment_result").css("display","block"),""!=t.err&&null!=t.err&&($("#comment_err_output").fadeIn(),$("#comment_err_output").html(t.err),setTimeout(function(){$("#comment_err_output").fadeOut()},1e4),"Mailer Error"!=t.err.substring(0,12)&&clear_comment_form()),""!=t.msg&&(visual_editor_comments_enabled?visual_editors[e].reset():$("#comment_box").val("")),t.cid){$(".no-comments").remove(),get_the_comment(t.cid,t.type_id,"#comments-ul");var o=parseInt($("#comment_count").html());$("#comment_count").html((o+1).toString())}}else alert("No data")},"json")}function clear_comment_form(){$("#add_comment_button").val(lang_add_comment),$("#add_comment_button").attr("disabled",!1),$(".add-reply").attr("disabled",!1)}function init_visual_editor(e,t){return new toastui.Editor({el:document.querySelector(e),initialEditType:"wysiwyg",previewStyle:"vertical",height:"200px",usageStatistics:!1,toolbarItems:[["bold","italic","strike"],["ul","ol","task","indent","outdent"],["table","link"]],language:current_language,placeholder:t,theme:default_theme})}function reply_box(e,t,o){let n=lang_reply_to+" "+$(document).find("#says_"+e).attr("speaker")+"...";if(visual_editor_comments_enabled){let r='<div class="form-group clearfix"><div id="reply_box_'+e+'"></div></div>';r+='<input type="button" name="add_reply" id="add_reply_button_'+e+'" class="btn btn-primary pull-right add-reply" onclick="add_comment_js(\'reply_form_'+e+'\')" value="'+lang_reply+'">',r+='<input type="button" class="btn btn-primary pull-right" onclick="remove_reply_box(\''+e+'\')" value="'+lang.cancel+'">',$(".reply-box-"+e).html(r),visual_editors["reply_form_"+e]=init_visual_editor("#reply_box_"+e,n)}else{let l='<form name="reply_form" method="post" id="reply_form_'+e+'" onsubmit="return false;">';l+='<input type="hidden" name="reply_to" id="reply_to" value="'+e+'">',l+='<input type="hidden" name="obj_id" id="obj_id" value="'+o+'">',l+='<input type="hidden" name="type" value="'+t+'" />',l+='<div class="textarea-comment clearfix">',l+='<textarea name="comment" id="reply_box_'+e+'" class="form-control" placeholder="'+n+'"></textarea>',l+='<i class="remove-'+e+' remove-icon" onclick="remove_reply_box('+e+')">',l+='<span style="color:#006dcc;cursor:pointer">',l+='<strong class="icon-close"></strong>',l+="</span>",l+="</i>",l+="</div>",l+='<input type="button" name="add_reply" id="add_reply_button_'+e+'" class="btn btn-primary pull-right add-reply" onclick="add_comment_js(\'reply_form_'+e+'\')" value="'+lang_reply+'">',l+="</form>",$(".reply-box-"+e).html(l),$("#reply_box_"+e).focus()}$(".reply-box-"+e).slideDown("slow")}function remove_reply_box(e){$(".reply-box-"+e).slideUp("slow").children().remove()}function show_replies(e){$(".more-comments-"+e).show()}function spam_comment(e){$.post(page,{mode:"spam_comment",cid:e},function(t){t?(t.msg&&($("#comment_"+e).hide(),$("#spam_comment_"+e).fadeIn("slow")),t.err&&($("#comment_err_output").fadeIn("slow"),$("#comment_err_output").html(t.err))):alert("No data")},"json")}function to_reply(e){$("#reply_to").val(e),window.location="#reply",$("#reply_to_img").fadeIn(1500),setTimeout(function(){$("#reply_to_img").fadeOut(500)},7e3)}$(document).ready(function(){visual_editor_comments_enabled&&(visual_editors.comment_form=init_visual_editor("#comment_box_visual_editor",visual_editor_comments_placeholder)),$("#add_comment_button").on("click",function(){visual_editor_comments_enabled&&$("#comment_box").val(visual_editors.comment_form.getMarkdown()),add_comment_js("comment_form")}),$("#comment_box").keypress(function(e){13!=e.keyCode||e.shiftKey||(e.preventDefault(),add_comment_js("comment_form"))})});
