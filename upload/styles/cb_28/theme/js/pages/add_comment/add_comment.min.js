var visual_editors={};function get_the_comment(o,e,n){$.post(page,{mode:"get_comment",cid:o,type_id:e},function(e){var t;e?e.parent_id?($(".reply-box-"+e.parent_id).hide(),$(".comments-reply-"+e.parent_id).append(e.li_data).slideDown(),visual_editor_comments_enabled&&(t=(t=document.querySelectorAll(".comments-reply-"+e.parent_id+" .commented-txt p"))[t.length-1],new toastui.Editor.factory({el:t,viewer:!0,usageStatistics:!1,initialValue:t.innerHTML})),$("html, body").animate({scrollTop:$("#reply-"+o).offset().top},1e3),comment_transition(".reply-",o)):($(e.li_data).hide().prependTo(n),visual_editor_comments_enabled&&(t=document.querySelectorAll(n+" p")[0],new toastui.Editor.factory({el:t,viewer:!0,usageStatistics:!1,initialValue:t.innerHTML})),$(n).children().first().slideDown("slow")):alert("No data"),clear_comment_form()},"json")}function add_comment_js(t){$("#add_comment_result").css("display","block"),$("#add_comment_button").val(lang_loading),$("#add_comment_button").attr("disabled",!0),$(".add-reply").attr("disabled",!0);var e=$("#"+t).serialize()+"&mode=add_comment";$.post(page,e,function(e){e?($("#add_comment_result").css("display","block"),""!=e.err&&null!=e.err&&($("#comment_err_output").fadeIn(),$("#comment_err_output").html(e.err),setTimeout(function(){$("#comment_err_output").fadeOut()},1e4),"Mailer Error"!=e.err.substring(0,12))&&clear_comment_form(),""!=e.msg&&(visual_editor_comments_enabled?visual_editors[t].reset():$("#comment_box").val("")),e.cid&&($(".no-comments").remove(),get_the_comment(e.cid,e.type_id,"#comments-ul"),e=parseInt($("#comment_count").html()),$("#comment_count").html((e+1).toString()))):alert("No data")},"json")}function clear_comment_form(){$("#add_comment_button").val(lang_add_comment),$("#add_comment_button").attr("disabled",!1),$(".add-reply").attr("disabled",!1)}function init_visual_editor(e,t){return 0!==$(e).length&&new toastui.Editor({el:document.querySelector(e),initialEditType:"wysiwyg",previewStyle:"vertical",usageStatistics:!1,toolbarItems:[["bold","italic","strike"],["ul","ol","indent","outdent"],["link"]],language:current_language,placeholder:t,theme:default_theme})}function reply_box(e,t,o){var n=$(document).find("#says_"+e).attr("speaker"),n=lang_reply_to+" "+n+"...";let r='<form name="reply_form" method="post" id="reply_form_'+e+'" onsubmit="return false;">';r=(r+='<input type="hidden" name="reply_to" id="reply_to" value="'+e+'">')+'<input type="hidden" name="obj_id" id="obj_id" value="'+o+'"> <input type="hidden" name="type" value="'+t+'" />',r=visual_editor_comments_enabled?(r+='<input type="hidden" name="comment" id="reply_comment_'+e+'"/>')+'<div class="form-group clearfix"><div id="reply_box_'+e+'"></div></div>':(r=(r=(r=(r+='<div class="textarea-comment clearfix">')+'<textarea name="comment" id="reply_box_'+e+'" class="form-control" placeholder="'+n+'"></textarea>')+'<i class="remove-'+e+' remove-icon" onclick="remove_reply_box('+e+')"><span style="color:#006dcc;cursor:pointer">')+'<strong class="icon-close"></strong></span>')+"</i></div>",r+='<input type="button" name="add_reply" id="add_reply_button_'+e+'" class="btn btn-primary pull-right add-reply" value="'+lang_reply+'">',visual_editor_comments_enabled&&(r+='<input type="button" class="btn btn-primary pull-right" onclick="remove_reply_box(\''+e+'\')" value="'+lang.cancel+'">'),$(".reply-box-"+e).html(r),visual_editor_comments_enabled?visual_editors["reply_form_"+e]=init_visual_editor("#reply_box_"+e,n):$("#reply_box_"+e).focus(),$("#add_reply_button_"+e).on("click",function(){visual_editor_comments_enabled&&$("#reply_comment_"+e).val(visual_editors["reply_form_"+e].getMarkdown()),add_comment_js("reply_form_"+e)}),$(".reply-box-"+e).slideDown("slow")}function remove_reply_box(e){$(".reply-box-"+e).slideUp("slow").children().remove()}function show_replies(e){$(".more-comments-"+e).show()}function spam_comment(t){$.post(page,{mode:"spam_comment",cid:t},function(e){e?(e.msg&&($("#comment_"+t).hide(),$("#spam_comment_"+t).fadeIn("slow")),e.err&&($("#comment_err_output").fadeIn("slow"),$("#comment_err_output").html(e.err))):alert("No data")},"json")}function to_reply(e){$("#reply_to").val(e),window.location="#reply",$("#reply_to_img").fadeIn(1500),setTimeout(function(){$("#reply_to_img").fadeOut(500)},7e3)}$(document).ready(function(){visual_editor_comments_enabled&&(visual_editors.comment_form=init_visual_editor("#comment_box_visual_editor",visual_editor_comments_placeholder)),$("#add_comment_button").on("click",function(){visual_editor_comments_enabled&&$("#comment_box").val(visual_editors.comment_form.getMarkdown()),add_comment_js("comment_form")}),visual_editor_comments_enabled||$("#comment_box").keypress(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),add_comment_js("comment_form"))}),document.addEventListener("postThemeSwitch",function(e){"light"===e.detail.theme?document.querySelectorAll(".toastui-editor-defaultUI.toastui-editor-dark").forEach(e=>{e.classList.remove("toastui-editor-dark")}):(document.querySelectorAll(".toastui-editor-defaultUI").forEach(e=>{e.classList.contains("toastui-editor-dark")||e.classList.add("toastui-editor-dark")}),document.querySelector(`link[href="${toastui_editor_theme_dark_url}"]`)||((e=document.createElement("link")).rel="stylesheet",e.href=toastui_editor_theme_dark_url,e.type="text/css",document.head.appendChild(e)))})});