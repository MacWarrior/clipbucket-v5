/**
 * Plupload - multi-runtime File Uploader
 * v3.1.2
 *
 * Copyright 2018, Ephox
 * Released under AGPLv3 License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 *
 * Date: 2018-02-20
 */
!function(t,e){var i=function(){var t={};return e.apply(t,arguments),t.plupload};"function"==typeof define&&define.amd?define("plupload",["./moxie"],i):"object"==typeof module&&module.exports?module.exports=i(require("./moxie")):t.plupload=i(t.moxie)}(this||window,function(t){!function(e,i){"use strict";var n={};function r(t,e,r){if("string"!=typeof t)throw"invalid module definition, module id must be defined and be a string";if(e===i)throw"invalid module definition, dependencies must be specified";if(r===i)throw"invalid module definition, definition function must be specified";!function t(e,i){for(var r,s=[],a=0;a<e.length;++a){if(!(r=n[e[a]]||o(e[a])))throw"module definition dependecy not found: "+e[a];s.push(r)}i.apply(null,s)}(e,function(){n[t]=r.apply(null,arguments)})}function s(t){return!!n[t]}function o(t){for(var i=e,n=t.split(/[.\/]/),r=0;r<n.length;++r){if(!i[n[r]])return;i=i[n[r]]}return i}r("plupload",[],function(){var e=t,i=e.core.utils;return i.Env.global_event_dispatcher="plupload.EventTarget.instance.dispatchEvent",{VERSION:"3.1.2",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,OPTION_ERROR:-800,moxie:e,ua:i.Env,typeOf:i.Basic.typeOf,clone:i.Basic.clone,inherit:i.Basic.inherit,extend:i.Basic.extend,extendImmutable:i.Basic.extendImmutable,extendIf:i.Basic.extendIf,inSeries:i.Basic.inSeries,inParallel:i.Basic.inParallel,guid:i.Basic.guid,getAll:function t(e){var n,r=[];"array"!==i.Basic.typeOf(e)&&(e=[e]);for(var s=e.length;s--;)(n=i.Dom.get(e[s]))&&r.push(n);return r.length?r:null},get:i.Dom.get,each:i.Basic.each,getPos:i.Dom.getPos,getSize:i.Dom.getSize,xmlEncode:function(t){var e={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"};return t?(""+t).replace(/[<>&\"\']/g,function(t){return e[t]?"&"+e[t]+";":t}):t},toArray:i.Basic.toArray,inArray:i.Basic.inArray,addI18n:e.core.I18n.addI18n,translate:e.core.I18n.translate,sprintf:i.Basic.sprintf,isEmptyObj:i.Basic.isEmptyObj,hasClass:i.Dom.hasClass,addClass:i.Dom.addClass,removeClass:i.Dom.removeClass,getStyle:i.Dom.getStyle,addEvent:i.Events.addEvent,removeEvent:i.Events.removeEvent,removeAllEvents:i.Events.removeAllEvents,cleanName:function(t){var e,i;for(e=0,i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];e<i.length;e+=2)t=t.replace(i[e],i[e+1]);return t=(t=t.replace(/\s+/g,"_")).replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(t,e){var n="";return i.Basic.each(e,function(t,e){n+=(n?"&":"")+encodeURIComponent(e)+"="+encodeURIComponent(t)}),n&&(t+=(t.indexOf("?")>0?"&":"?")+n),t},formatSize:function(t){function e(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}if(isNaN(t=parseInt(t,10)))return this.translate("N/A");var i=1099511627776;return t>i?e(t/i,1)+" "+this.translate("tb"):t>(i/=1024)?e(t/i,1)+" "+this.translate("gb"):t>(i/=1024)?e(t/i,1)+" "+this.translate("mb"):t>1024?Math.round(t/1024)+" "+this.translate("kb"):t+" "+this.translate("b")},mimes2extList:t.core.utils.Mime.mimes2extList,resolveUrl:i.Url.resolveUrl,parseSize:i.Basic.parseSizeStr,delay:i.Basic.delay,EventTarget:t.core.EventTarget,Runtime:t.runtime.Runtime,FileInput:t.file.FileInput,FileReader:t.file.FileReader}}),r("plupload/core/Collection",["plupload"],function(t){var e=function(){var t,i={},n=0;plupload.extend(this,{count:function(){return n},hasKey:function(t){return i.hasOwnProperty(t)},get:function(t){return i[t]},first:function(){for(var t in i)return i[t]},last:function(){return t},toObject:function(){return i},add:function(e,r){var s=this;return"object"!=typeof e||r?i.hasOwnProperty(e)?s.update.apply(s,arguments):void(i[e]=t=r,n++):plupload.each(e,function(t,e){s.add(e,t)})},remove:function(e){if(this.hasKey(e)){var r=i[e];delete i[e],n--,t===r&&(t=function t(){var e;for(e in i);return i[e]}())}},extract:function(t){var e=this.get(t);return this.remove(t),e},shift:function(){var t,e;for(e in i)return t=i[e],this.remove(e),t},update:function(t,e){i[t]=e},each:function(t){plupload.each(i,t)},combineWith:function(){var t=new e;return t.add(i),plupload.each(arguments,function(i){i instanceof e&&t.add(i.toObject())}),t},clear:function(){i={},t=null,n=0}})};return e}),r("plupload/core/ArrCollection",["plupload"],function(t){return function(){var e=[];t.extend(this,{count:function(){return e.length},hasKey:function(t){return this.getIdx(t)>-1},get:function(t){var i=this.getIdx(t);return i>-1?e[i]:null},getIdx:function(t){for(var i=0,n=e.length;i<n;i++)if(e[i].uid===t)return i;return -1},getByIdx:function(t){return e[t]},first:function(){return e[0]},last:function(){return e[e.length-1]},add:function(t){t=arguments[1]||t;var i=this.getIdx(t.uid);return i>-1?(e[i]=t,i):(e.push(t),e.length-1)},remove:function(t){return!!this.extract(t)},splice:function(i,n){return i="undefinded"===t.typeOf(i)?0:Math.max(i,0),n="undefinded"!==t.typeOf(n)&&i+n<e.length?n:e.length-i,e.splice(i,n)},extract:function(t){var i=this.getIdx(t);return i>-1?e.splice(i,1):null},shift:function(){return e.shift()},update:function(t,i){var n=this.getIdx(t);return n>-1&&(e[n]=i,!0)},each:function(i){t.each(e,i)},combineWith:function(){return Array.prototype.concat.apply(this.toArray(),arguments)},sort:function(t){e.sort(t||function(t,e){return t.priority-e.priority})},clear:function(){e=[]},toObject:function(){for(var t={},i=0,n=e.length;i<n;i++)t[e[i].uid]=e[i];return t},toArray:function(){return Array.prototype.slice.call(e)}})}}),r("plupload/core/Optionable",["plupload"],function(e){var i;return function(t){function i(){t.apply(this,arguments),this._options={}}return e.inherit(i,t),e.extend(i.prototype,{setOption:function(t,i,n){var r,s=this;if("object"==typeof t){n=i,e.each(t,function(t,e){s.setOption(e,t,n)});return}(!n||s._options.hasOwnProperty(t))&&(r=e.clone(s._options[t]),"object"===e.typeOf(i)&&"object"===e.typeOf(s._options[t])?e.extend(s._options[t],i):s._options[t]=i,s.trigger("OptionChanged",t,i,r))},getOption:function(t){if(!t)return this._options;var i=this._options[t];return e.inArray(e.typeOf(i),["array","object"])>-1?e.extendImmutable({},i):i},setOptions:function(t,e){"object"==typeof t&&this.setOption(t,e)},getOptions:function(){return this.getOption()}}),i}(t.core.EventTarget)}),r("plupload/core/Queueable",["plupload","plupload/core/Optionable"],function(t,e){return function(e){function n(){e.apply(this,arguments),this.uid=t.guid(),this.state=n.IDLE,this.processed=0,this.total=0,this.percent=0,this.retries=0,this.priority=0,this.startedTimestamp=0,this.processedTimestamp=0,MXI_DEBUG&&this.bind("StateChanged",function(e,i,r){var s=this,o=function(t){switch(t){case n.IDLE:return"IDLE";case n.PROCESSING:return"PROCESSING";case n.PAUSED:return"PAUSED";case n.RESUMED:return"RESUMED";case n.DONE:return"DONE";case n.FAILED:return"FAILED";case n.DESTROYED:return"DESTROYED"}};t.ua.log("StateChanged:"+function(){switch(s.ctorName){case"File":return"	".repeat(2);case"QueueUpload":case"QueueResize":default:return"	";case"FileUploader":return"	".repeat(3);case"ChunkUploader":return"	".repeat(4)}}()+s.ctorName+"::"+s.uid+" ("+o(r)+" to "+o(i)+")")},999)}return n.IDLE=1,n.PROCESSING=2,n.PAUSED=6,n.RESUMED=7,n.DONE=5,n.FAILED=4,n.DESTROYED=8,t.inherit(n,e),t.extend(n.prototype,{start:function(){var t=this.state;return this.state!==n.PROCESSING&&(this.startedTimestamp||(this.startedTimestamp=+new Date),this.state=n.PROCESSING,this.trigger("statechanged",this.state,t),this.trigger("started"),!0)},pause:function(){var e=this.state;return -1!==t.inArray(this.state,[n.IDLE,n.RESUMED,n.PROCESSING])&&(this.processed=this.percent=0,this.loaded=this.processed,this.state=n.PAUSED,this.trigger("statechanged",this.state,e),this.trigger("paused"),!0)},resume:function(){var t=this.state;return(this.state===n.PAUSED||this.state===n.RESUMED)&&(this.state=n.RESUMED,this.trigger("statechanged",this.state,t),this.trigger("resumed"),!0)},stop:function(){var t=this.state;return this.state!==n.IDLE&&(this.processed=this.percent=0,this.loaded=this.processed,this.startedTimestamp=0,this.state=n.IDLE,this.trigger("statechanged",this.state,t),this.trigger("stopped"),!0)},abort:function(t){var e=this.state;if(this.state===n.IDLE)return!1;this.processed=1,this.percent=0,this.loaded=this.processed,this.startedTimestamp=0;let r=!1;return this._queue.toArray().forEach(function(e){i!==e._options.params&&e._options.params.unique_id==t&&e.state==n.PROCESSING&&(r=!0)}),!0===r&&$(document).trigger("CancelCurrentUpload"),$(document).trigger("CancelFile",[t]),$(document).trigger("startNextFile"),this.trigger("statechanged",this.state,e),this.trigger("processed"),!0},done:function(t){var e=this.state;return this.state!==n.DONE&&(this.processed=this.total,this.loaded=this.processed,this.percent=100,this.processedTimestamp=+new Date,this.state=n.DONE,this.trigger("statechanged",this.state,e),this.trigger("done",t),this.trigger("processed"),!0)},failed:function(t){var e=this.state;return this.state!==n.FAILED&&(this.processed=this.percent=0,this.loaded=this.processed,this.processedTimestamp=+new Date,this.state=n.FAILED,this.trigger("statechanged",this.state,e),this.trigger("failed",t),this.trigger("processed"),!0)},progress:function(t,e){e&&(this.total=e),this.processed=Math.min(t,this.total),this.loaded=this.processed,this.percent=Math.ceil(this.processed/this.total*100),this.trigger({type:"progress",loaded:this.processed,total:this.total})},destroy:function(){var t=this.state;return this.state!==n.DESTROYED&&(this.state=n.DESTROYED,this.trigger("statechanged",this.state,t),this.trigger("destroy"),this.unbindAll(),!0)}}),n}(e)}),r("plupload/core/Stats",[],function(){return function(){var t=this;t.size=0,t.total=0,t.loaded=0,t.uploaded=0,t.done=0,t.failed=0,t.queued=0,t.paused=0,t.processing=0,t.paused=0,t.percent=0,t.bytesPerSec=0,t.processedPerSec=0,t.reset=function(){t.size=t.total=t.loaded=t.processed=t.uploaded=t.done=t.failed=t.queued=t.processing=t.paused=t.percent=t.bytesPerSec=t.processedPerSec=0}}}),r("plupload/core/Queue",["plupload","plupload/core/ArrCollection","plupload/core/Queueable","plupload/core/Stats"],function(t,e,i,n){return function(r){function s(i){r.apply(this,arguments),this._queue=new e,this.stats=new n,this._options=t.extend({},this._options,{max_slots:1,max_retries:0,auto_start:!1,finish_active:!1},i)}function o(){var t;return this.forEachItem(function(e){if(e.state===i.IDLE||e.state===i.RESUMED)return t=e,!1}),t||null}function a(){var t;if(this.state!==i.PROCESSING&&this.state!==i.PAUSED)return!1;if(this.stats.processing<this.getOption("max_slots")&&(t=o.call(this))){if(t.trigger("beforestart"))return t.setOptions(this.getOptions()),t.start();t.pause(),a.call(this)}return!1}return t.inherit(s,r),t.extend(s.prototype,{count:function(){return this._queue.count()},start:function(){let t=this;return $(document).bind("startNextFile",function(){a.call(t)}),!!s.parent.start.call(this)&&a.call(this)},pause:function(){if(!s.parent.pause.call(this))return!1;this.forEachItem(function(t){t.pause()})},stop:function(){if(!s.parent.stop.call(this)||this.getOption("finish_active"))return!1;this.isActive()&&this.forEachItem(function(t){t.stop()})},forEachItem:function(t){this._queue.each(t)},getItem:function(t){return this._queue.get(t)},addItem:function(e){var n=this;e.bind("Started",function(){n.calcStats()&&t.delay.call(n,a)}),e.bind("Resumed",function(){n.start()}),e.bind("Paused",function(){n.calcStats()&&t.delay.call(n,function(){a.call(n)||n.stats.processing||n.pause()})}),e.bind("Processed Stopped",function(){n.calcStats()&&t.delay.call(n,function(){a.call(n)||this.isStopped()||this.isActive()||n.stop()})}),e.bind("Progress",function(){n.calcStats()&&n.trigger("Progress",n.stats.processed,n.stats.total,n.stats)}),e.bind("Failed",function(){n.getOption("max_retries")&&this.retries<n.getOption("max_retries")&&(this.stop(),this.retries++)}),this._queue.add(e.uid,e),this.calcStats(),e.trigger("Queued"),(n.getOption("auto_start")||n.state===i.PAUSED)&&t.delay.call(this,this.start)},extractItem:function(t){var e=this._queue.get(t);return e&&(this.stopItem(e.uid),this._queue.remove(t),this.calcStats()),e},removeItem:function(t){var e=this.extractItem(t);return!!e&&(e.destroy(),!0)},stopItem:function(t){var e=this._queue.get(t);return!!e&&e.stop()},pauseItem:function(t){var e=this._queue.get(t);return!!e&&e.pause()},resumeItem:function(e){var i=this._queue.get(e);return!!i&&(t.delay.call(this,function(){this.start()}),i.resume())},splice:function(t,e){return this._queue.splice(t,e)},isActive:function(){return this.stats&&(this.stats.processing||this.stats.paused)},isStopped:function(){return this.state===i.IDLE||this.state===i.DESTROYED},countSpareSlots:function(){return Math.max(this.getOption("max_slots")-this.stats.processing,0)},toArray:function(){return this._queue.toArray()},clear:function(){var t=this;if(t.state!==i.IDLE)return t.bindOnce("Stopped",function(){t.clear()}),t.stop();t._queue.clear(),t.stats.reset()},calcStats:function(){var t=this,e=t.stats,n=0,r=0;return!!e&&(e.reset(),t.forEachItem(function(s){switch(s.state){case i.DONE:e.done++,e.uploaded=e.done;break;case i.FAILED:e.failed++;break;case i.PROCESSING:e.processing++;break;case i.PAUSED:e.paused++;break;default:e.queued++}n+=s.processed,(!s.processedTimestamp||s.processedTimestamp>t.startedTimestamp)&&(r+=n),e.processedPerSec=Math.ceil(r/((+new Date-t.startedTimestamp||1)/1e3)),e.processed=n,e.total+=s.total,e.total&&(e.percent=Math.ceil(e.processed/e.total*100))}),t.percent=e.percent,e.loaded=e.processed,e.size=e.total,e.bytesPerSec=e.processedPerSec,!0)},destroy:function(){var e=this;return e.state!==i.DESTROYED&&(e.state!==i.IDLE?(e.bindOnce("Stopped",function(){t.delay.call(e,e.destroy)}),e.stop()):(e.clear(),s.parent.destroy.call(this),e._queue=e.stats=null,!0))}}),s}(i)}),r("plupload/QueueUpload",["plupload","plupload/core/Queue"],function(t,e){return function(i){function n(t){e.call(this,{max_slots:1,max_retries:0,auto_start:!1,finish_active:!1,url:!1,chunk_size:0,multipart:!0,http_method:"POST",params:{},headers:!1,file_data_name:"file",send_file_name:!0,stop_on_fail:!0}),this.setOption=function(t,e){"object"!=typeof t&&"max_upload_slots"==t&&(t="max_slots"),n.prototype.setOption.call(this,t,e,!0)},this.setOptions(t)}return t.inherit(n,i),n}(e)}),r("plupload/QueueResize",["plupload","plupload/core/Queue"],function(t,e){return function(i){function n(t){e.call(this,{max_slots:1,max_retries:0,auto_start:!1,finish_active:!1,resize:{}}),this.setOption=function(t,e){"object"!=typeof t&&"max_resize_slots"==t&&(t="max_slots"),n.prototype.setOption.call(this,t,e,!0)},this.setOptions(t)}return t.inherit(n,i),n}(e)}),r("plupload/ChunkUploader",["plupload","plupload/core/Collection","plupload/core/Queueable"],function(e,n,r){var s=t.xhr.XMLHttpRequest,o=t.xhr.FormData;function a(t){var n;r.call(this),this._options={file_data_name:"file",headers:!1,http_method:"POST",multipart:!0,params:{},send_file_name:!0,url:!1},e.extend(this,{start:function(){var a,u,l,c,p,d=this,h=this.state,f=d._options;if(this.state===r.PROCESSING)return!1;if(this.startedTimestamp||(this.startedTimestamp=+new Date),this.state=r.PROCESSING,this.trigger("statechanged",this.state,h),n=new s,i!==e.id_cancel&&-1!==e.id_cancel.indexOf(this._options.params.unique_id)){this.failed();return}n.upload&&(n.upload.onprogress=function(t){d.progress(t.loaded,t.total)}),n.onload=function(){var t={response:this.responseText,status:this.status,responseHeaders:this.getAllResponseHeaders()};if(this.status<200||this.status>=400)return d.failed(t);d.done(t)},n.onerror=function(){d.failed()},n.onloadend=function(){setTimeout(function(){n&&(n.destroy(),n=null)},1)},$(document).bind("CancelCurrentUpload",function(){n&&(n.abort(),n=null,d.failed())}),$(document).bind("CancelFile",function(t,n){i===e.id_cancel&&(e.id_cancel=[]),e.id_cancel.push(n)});try{c=f.multipart?f.url:(a=f.url,u=f.params,l="",e.each(u,function(t,e){l+=(l?"&":"")+encodeURIComponent(e)+"="+encodeURIComponent(t)}),l&&(a+=(a.indexOf("?")>0?"&":"?")+l),a),n.open(f.http_method,c,!0),e.isEmptyObj(f.headers)||e.each(f.headers,function(t,e){n.setRequestHeader(e,t)}),f.multipart?(p=new o,e.isEmptyObj(f.params)||e.each(f.params,function(t,e){p.append(e,t)}),p.append(f.file_data_name,t),n.send(p)):((e.isEmptyObj(f.headers)||!n.hasRequestHeader("content-type"))&&n.setRequestHeader("content-type","application/octet-stream"),n.send(t)),this.trigger("started")}catch(g){d.failed()}},stop:function(){n&&(n.abort(),n.destroy(),n=null),a.prototype.stop.call(this)},setOption:function(t,e){a.prototype.setOption.call(this,t,e,!0)},setOptions:function(t){a.prototype.setOption.call(this,t,!0)},destroy:function(){this.stop(),a.prototype.destroy.call(this)}})}return e.inherit(a,r),a}),r("plupload/FileUploader",["plupload","plupload/core/Collection","plupload/core/Queueable","plupload/ChunkUploader"],function(t,e,i,n){function r(s,o){var a=new e,u=1;function l(){var t=0;return a.each(function(e){e.state===i.DONE&&(t+=e.end-e.start)}),t}function c(){for(var t=0;t<u&&a.hasKey(t);)t++;return t}i.call(this),this._options={chunk_size:0,params:{},send_file_name:!0,stop_on_fail:!0},t.extend(this,{name:s.name,start:function(){var t,e=this,r=this.state;if(this.state===i.PROCESSING)return!1;this.startedTimestamp||(this.startedTimestamp=+new Date),this.state=i.PROCESSING,this.trigger("statechanged",this.state,r),e._options.send_file_name&&(e._options.params.name=e.target_name||e.name),e._options.chunk_size?(u=Math.ceil(s.size/e._options.chunk_size),e.uploadChunk(!1,!0)):((t=new n(s)).bind("progress",function(t){e.progress(t.loaded,t.total)}),t.bind("done",function(t,i){e.done(i)}),t.bind("failed",function(t,i){e.failed(i)}),t.setOptions(e._options),o.addItem(t)),this.trigger("started")},uploadChunk:function(e,r){var p,d,h=this,f=this.getOption("chunk_size"),g={};return g.seq=parseInt(e,10)||c(),g.start=g.seq*f,g.end=Math.min(g.start+f,s.size),g.total=s.size,!(g.start<0)&&!(g.start>=s.size)&&(d=t.extendImmutable({},this.getOptions(),{params:{chunk:g.seq,chunks:u}}),(p=new n(s.slice(g.start,g.end,s.type))).bind("progress",function(t){h.progress(l()+t.loaded,s.size)}),p.bind("failed",function(e,n){a.add(g.seq,t.extend({state:i.FAILED},g)),h.trigger("chunkuploadfailed",t.extendImmutable({},g,n)),d.stop_on_fail&&h.failed(n)}),p.bind("done",function(e,n){a.add(g.seq,t.extend({state:i.DONE},g)),$(document).trigger("chunkuploaded",t.extendImmutable({},g,n,p)),l()>=s.size?(h.progress(s.size,s.size),h.done(n)):r&&t.delay(function(){h.uploadChunk(c(),r)})}),p.bind("processed",function(){this.destroy()}),p.setOptions(d),a.add(g.seq,t.extend({state:i.PROCESSING},g)),o.addItem(p),r&&o.countSpareSlots()&&h.uploadChunk(c(),r),!0)},destroy:function(){r.prototype.destroy.call(this),a.clear()}})}return t.inherit(r,i),r}),r("plupload/ImageResizer",["plupload","plupload/core/Queueable"],function(e,i){var n=t.image.Image;function r(t){i.call(this),this._options={type:"image/jpeg",quality:90,crop:!1,fit:!0,preserveHeaders:!0,resample:"default",multipass:!0},this.setOption=function(t,e){("object"==typeof t||this._options.hasOwnProperty(t))&&r.prototype.setOption.apply(this,arguments)},this.start=function(e){var i,r=this;e&&this.setOptions(e.resize),(i=new n).bind("load",function(){this.resize(r.getOptions())}),i.bind("resize",function(){r.done(this.getAsBlob(r.getOption("type"),r.getOption("quality"))),this.destroy()}),i.bind("error",function(){r.failed(),this.destroy()}),i.load(t,r.getOption("runtimeOptions"))}}return e.inherit(r,i),e.Image=n,r}),r("plupload/File",["plupload","plupload/core/Queueable","plupload/FileUploader","plupload/ImageResizer"],function(t,e,i,n){function r(s,o,a){e.call(this),t.extend(this,{id:this.uid,name:s.name,target_name:null,type:s.type,size:s.size,origSize:s.size,start:function(){var i,n=this.state;return this.state!==e.PROCESSING&&(this.state=e.PROCESSING,this.trigger("statechanged",this.state,n),this.trigger("started"),!t.isEmptyObj(this._options.resize)&&(i=this.type,t.inArray(i,["image/jpeg","image/png"])>-1)&&function e(i,n){if(i.ruid){var r=t.Runtime.getInfo(i.ruid);if(r)return r.can(n)}return!1}(s,"send_binary_string")?this.resizeAndUpload():this.upload(),!0)},getSource:function(){return s},getNative:function(){return this.getFile().getSource()},resizeAndUpload:function(){var t=this,e=t.getOptions(),i=new n(s);i.bind("progress",function(e){t.progress(e.loaded,e.total)}),i.bind("done",function(e,i){t.upload()}),i.bind("failed",function(){t.upload()}),i.setOption("runtimeOptions",{runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:e.preferred_caps,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url}),a.addItem(i)},upload:function(){var t=this,e=new i(s,o);e.bind("paused",function(){t.pause()}),e.bind("resumed",function(){this.start()}),e.bind("started",function(){t.trigger("startupload")}),e.bind("progress",function(e){t.progress(e.loaded,e.total)}),e.bind("done",function(e,i){t.done(i)}),e.bind("failed",function(e,i){t.failed(i)}),e.setOptions(t.getOptions()),e.start()},destroy:function(){r.prototype.destroy.call(this),s=null}})}return t.inherit(r,e),r}),r("plupload/Uploader",["plupload","plupload/core/Collection","plupload/core/Queue","plupload/QueueUpload","plupload/QueueResize","plupload/File"],function(e,i,n,r,s,o){var a,u,l,c,p,d={};function h(i){var a,u,l,c=[],f=[],m=!1,O=!1,b=(a=e.extend({backward_compatibility:!0,chunk_size:0,file_data_name:"file",filters:{mime_types:"*",prevent_duplicates:!1,max_file_size:0},flash_swf_url:"js/Moxie.swf",http_method:"POST",max_resize_slots:1,max_retries:0,max_upload_slots:1,multipart:!0,multipart_params:{},multi_selection:!0,params:{},resize:!1,runtimes:e.Runtime.order,send_chunk_number:!0,send_file_name:!0,silverlight_xap_url:"js/Moxie.xap",required_features:!1,preferred_caps:!1},i),e.each(a,function(t,e){a[e]=g(e,t,a)}),a);function y(){var t=c[0]||f[0];return!!t&&t.getRuntime().uid}function E(){this.bind("FilesAdded FilesRemoved",function(t){t.trigger("QueueChanged"),t.refresh()},this,999),this.bind("BeforeUpload",R),this.bind("Stopped",function(t){t.trigger("UploadComplete")}),this.bind("Error",I),this.bind("Destroy",S)}function v(i){var n=this,r=0,s=[],o={runtime_order:n.getOption("runtimes"),required_caps:n.getOption("required_features"),preferred_caps:n.getOption("preferred_caps"),swf_url:n.getOption("flash_swf_url"),xap_url:n.getOption("silverlight_xap_url")};e.each(n.getOption("runtimes").split(/\s*,\s*/),function(t){n.getOption(t)&&(o[t]=n.getOption(t))}),n.getOption("browse_button")&&e.each(n.getOption("browse_button"),function(i){s.push(function(s){var a=new t.file.FileInput(e.extend({},o,{accept:n.getOption("filters").mime_types,name:n.getOption("file_data_name"),multiple:n.getOption("multi_selection"),container:n.getOption("container"),browse_button:i}));a.onready=function(){var t=e.Runtime.getInfo(this.ruid);e.extend(n.features,{chunks:t.can("slice_blob"),multipart:t.can("send_multipart"),multi_selection:t.can("select_multiple")}),r++,c.push(this),s()},a.onchange=function(){n.addFile(this.files)},a.bind("mouseenter mouseleave mousedown mouseup",function(t){!O&&(n.getOption("browse_button_hover")&&("mouseenter"===t.type?e.addClass(i,n.getOption("browse_button_hover")):"mouseleave"===t.type&&e.removeClass(i,n.getOption("browse_button_hover"))),n.getOption("browse_button_active")&&("mousedown"===t.type?e.addClass(i,n.getOption("browse_button_active")):"mouseup"===t.type&&e.removeClass(i,n.getOption("browse_button_active"))))}),a.bind("mousedown",function(){n.trigger("Browse")}),a.bind("error runtimeerror",function(){a=null,s()}),a.init()})}),n.getOption("drop_element")&&e.each(n.getOption("drop_element"),function(i){s.push(function(s){var a=new t.file.FileDrop(e.extend({},o,{drop_zone:i}));a.onready=function(){var t=e.Runtime.getInfo(this.ruid);e.extend(n.features,{chunks:t.can("slice_blob"),multipart:t.can("send_multipart"),dragdrop:t.can("drag_and_drop")}),r++,f.push(this),s()},a.ondrop=function(){n.addFile(this.files)},a.bind("error runtimeerror",function(){a=null,s()}),a.init()})}),e.inParallel(s,function(){"function"==typeof i&&i(r)})}function R(t,e){if(t.getOption("unique_names")){var i=e.name.match(/\.([^.]+)$/),n="part";i&&(n=i[1]),e.target_name=e.id+"."+n}}function I(t,i){i.code===e.INIT_ERROR?t.destroy():i.code===e.HTTP_ERROR&&t.state==e.STARTED&&t.trigger("CancelUpload")}function S(t){t.forEachItem(function(t){t.destroy()}),c.length&&(e.each(c,function(t){t.destroy()}),c=[]),f.length&&(e.each(f,function(t){t.destroy()}),f=[]),m=!1,u&&u.destroy(),l&&l.destroy(),b=u=l=null}n.call(this),e.extend(this,{_options:b,id:this.uid,state:e.STOPPED,features:{},settings:b,runtime:null,files:[],total:this.stats,init:function(){var t,i,n=this;return("function"==typeof(t=n.getOption("preinit"))?t(n):e.each(t,function(t,e){n.bind(e,t)}),E.call(n),e.each(["container","browse_button","drop_element"],function(t){if(null===n.getOption(t))return i={code:e.INIT_ERROR,message:e.sprintf(e.translate("%s specified, but cannot be found."),t)},!1}),i)?n.trigger("Error",i):n.getOption("browse_button")||n.getOption("drop_element")?void v.call(n,function(t){var i,o=n.getOption("init"),a=e.extendImmutable({},n.getOption(),{auto_start:!0});"function"==typeof o?o(n):e.each(o,function(t,e){n.bind(e,t)}),t?(m=!0,i=e.Runtime.getInfo(y()),u=new r(a),l=new s(a),n.trigger("Init",{ruid:i.uid,runtime:n.runtime=i.type}),n.trigger("PostInit")):n.trigger("Error",{code:e.INIT_ERROR,message:e.translate("Init error.")})}):n.trigger("Error",{code:e.INIT_ERROR,message:e.translate("You must specify either browse_button or drop_element.")})},setOption:function(t,i){if(m&&e.inArray(t,["container","browse_button","drop_element","runtimes","multi_selection","flash_swf_url","silverlight_xap_url"])>-1)return this.trigger("Error",{code:e.OPTION_ERROR,message:e.sprintf(e.translate("%s option cannot be changed.")),option:t});"object"!=typeof t&&(i=g(t,i,this._options),u&&u.setOption(t,i),l&&l.setOption(t,i)),h.prototype.setOption.call(this,t,i)},refresh:function(){c.length&&e.each(c,function(t){t.trigger("Refresh")}),f.length&&e.each(f,function(t){t.trigger("Refresh")}),this.trigger("Refresh")},stop:function(){h.prototype.stop.call(this)&&this.state!=e.STOPPED&&this.trigger("CancelUpload")},disableBrowse:function(){O=arguments[0]===p||arguments[0],c.length&&e.each(c,function(t){t.disable(O)}),this.trigger("DisableBrowse",O)},getFile:function(t){return this.getItem(t)},addFile:function(i,n){var r,s=this,a=[],c=[];r=y(),function i(p){var h=e.typeOf(p);if(p instanceof t.file.File){if(!p.ruid&&!p.isDetached()){if(!r)return!1;p.ruid=r,p.connectRuntime(r)}a.push(function(t){var i,r,a;i=p,r=function(i){var r,a;!i&&(r=new o(p,u,l),n&&(r.name=n),(a=r).bind("beforestart",function(t){return s.trigger("BeforeUpload",t.target)}),a.bind("startupload",function(){s.trigger("UploadFile",this)}),a.bind("progress",function(){s.trigger("UploadProgress",this)}),a.bind("done",function(t,e){s.trigger("FileUploaded",this,e)}),a.bind("failed",function(t,i){s.trigger("Error",e.extend({code:e.HTTP_ERROR,message:e.translate("HTTP Error."),file:this},i))}),s.addItem(r),c.push(r),s.trigger("FileFiltered",r)),e.delay(t)},a=[],e.each(s.getOption("filters"),function(t,e){d[e]&&a.push(function(n){d[e].call(s,t,i,function(t){n(!t)})})}),e.inParallel(a,r)})}else p instanceof t.file.Blob?(i(p.getSource()),p.destroy()):-1!==e.inArray(h,["file","blob"])?i(new t.file.File(null,p)):"node"===h&&"filelist"===e.typeOf(p.files)?e.each(p.files,i):"array"===h&&(n=null,e.each(p,i))}(i),a.length&&e.inParallel(a,function(){c.length&&s.trigger("FilesAdded",c)})},removeFile:function(t){var e=this.extractItem("string"==typeof t?t:t.uid);e&&(this.trigger("FilesRemoved",[e]),e.destroy())},splice:function(){var t=0,i=e.STARTED==this.state,r=n.prototype.splice.apply(this,arguments);if(r.length){for(this.trigger("FilesRemoved",r),i&&this.stop(),t=0;t<r.length;t++)r[t].destroy();i&&this.start()}},dispatchEvent:function(t){var e,i;if(t=t.toLowerCase(),e=this.hasEventListener(t)){e.sort(function(t,e){return e.priority-t.priority}),i=[].slice.call(arguments),i.shift(),i.unshift(this);for(var n=0;n<e.length;n++)if(!1===e[n].fn.apply(e[n].scope,i))return!1}return!0},bind:function(t,i,n,r){e.Uploader.prototype.bind.call(this,t,i,r,n)}}),b.backward_compatibility&&(this.bind("FilesAdded FilesRemoved",function(t){t.files=t.toArray()},this,999),this.bind("OptionChanged",function(t,i,n){t.settings[i]="object"==typeof n?e.extend({},n):n},this,999))}function f(t){var i=t.required_features,n={};function r(t,e,i){var r={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};r[t]?n[r[t]]=e:i||(n[t]=e)}return"string"==typeof i?e.each(i.split(/\s*,\s*/),function(t){r(t,!0)}):"object"==typeof i?e.each(i,function(t,e){r(e,t)}):!0===i&&(t.chunk_size&&t.chunk_size>0&&(n.slice_blob=!0),e.isEmptyObj(t.resize)&&!1!==t.multipart||(n.send_binary_string=!0),t.http_method&&(n.use_http_method=t.http_method),e.each(t,function(t,e){r(e,!!t,!0)})),n}function g(t,i,n){switch(t){case"chunk_size":(i=e.parseSize(i))&&(n.send_file_name=!0);break;case"headers":var r,s,o={};return"object"==typeof i&&e.each(i,function(t,e){o[e.toLowerCase()]=t}),o;case"http_method":return"PUT"===i.toUpperCase()?"PUT":"POST";case"filters":"array"===e.typeOf(i)&&(i={mime_types:i}),i.mime_types&&("string"===e.typeOf(i.mime_types)&&(i.mime_types=e.mimes2extList(i.mime_types)),n.re_ext_filter=(r=i.mime_types,s=[],e.each(r,function(t){e.each(t.extensions.split(/,/),function(t){/^\s*\*\s*$/.test(t)?s.push("\\.*"):s.push("\\."+t.replace(RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),RegExp("("+s.join("|")+")$","i")));break;case"max_file_size":n&&!n.filters&&(n.filters={}),n.filters.max_file_size=i;break;case"multipart":i||(n.send_file_name=!0);break;case"multipart_params":n.params=n.multipart_params=i;break;case"resize":if(i)return e.extend({preserve_headers:!0,crop:!1},i);return!1;case"prevent_duplicates":n&&!n.filters&&(n.filters={}),n.filters.prevent_duplicates=!!i;break;case"unique_names":i&&(n.send_file_name=!0);break;case"required_features":return f(e.extend({},n));case"preferred_caps":return f(e.extend({},n,{required_features:!0}));case"container":case"browse_button":case"drop_element":return"container"===t?e.get(i):e.getAll(i)}return i}function m(t,e){d[t]=e}return a=function(t,i,n){t.length&&!this.getOption("re_ext_filter").test(i.name)?(this.trigger("Error",{code:e.FILE_EXTENSION_ERROR,message:e.translate("File extension error."),file:i}),n(!1)):n(!0)},d.mime_types=a,u=function(t,i,n){var r;t=e.parseSize(t),i.size!==r&&t&&i.size>t?(this.trigger("Error",{code:e.FILE_SIZE_ERROR,message:e.translate("File size error."),file:i}),n(!1)):n(!0)},d.max_file_size=u,l=function(t,i,n){var r=this;t&&this.forEachItem(function(t){if(i.name===t.name&&i.size===t.size){r.trigger("Error",{code:e.FILE_DUPLICATE_ERROR,message:e.translate("Duplicate file error."),file:i}),n(!1);return}}),n(!0)},d.prevent_duplicates=l,c=function(t,i,n){t&&!i.size&&i.size!==p?(this.trigger("Error",{code:e.FILE_SIZE_ERROR,message:e.translate("File size error."),file:i}),n(!1)):n(!0)},d.prevent_empty=c,h.addFileFilter=m,e.inherit(h,n),e.addFileFilter=m,e.predictRuntime=function t(i,n){var r,s;return r=new h(i),s=e.Runtime.thatCan(r.getOption("required_features"),n||i.runtimes),r.destroy(),s},h}),function t(r){for(var s=0;s<r.length;s++){for(var o=e,a=r[s],u=a.split(/[.\/]/),l=0;l<u.length-1;++l)i===o[u[l]]&&(o[u[l]]={}),o=o[u[l]];o[u[u.length-1]]=n[a]}}(["plupload","plupload/core/Collection","plupload/core/ArrCollection","plupload/core/Optionable","plupload/core/Queueable","plupload/core/Stats","plupload/core/Queue","plupload/QueueUpload","plupload/QueueResize","plupload/ChunkUploader","plupload/FileUploader","plupload/ImageResizer","plupload/File","plupload/Uploader"])}(this)});
