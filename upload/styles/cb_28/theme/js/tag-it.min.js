!function(l){l.widget("ui.tagit",{options:{allowDuplicates:!1,caseSensitive:!0,fieldName:"tags",placeholderText:null,readOnly:!1,removeConfirmation:!1,tagLimit:null,tagTemplate:!1,availableTags:[],autocomplete:{},showAutocompleteOnFocus:!1,allowSpaces:!1,singleField:!1,singleFieldDelimiter:",",singleFieldNode:null,animate:!0,tabIndex:null,beforeTagAdded:null,afterTagAdded:null,beforeTagRemoved:null,afterTagRemoved:null,onTagClicked:null,onTagLimitExceeded:null,onTagAdded:null,onTagRemoved:null,tagSource:null},_create:function(){var t,e,i=this,a=(this.element.is("input")?(this.tagList=l("<ul></ul>").insertAfter(this.element),this.options.singleField=!0,this.options.singleFieldNode=this.element,this.element.addClass("tagit-hidden-field")):this.tagList=this.element.find("ul, ol").addBack().last(),this.tagInput=l('<input type="text" />'),this.options.readOnly&&this.tagInput.attr("disabled","disabled"),null!=this.options.tabIndex&&this.tagInput.attr("tabindex",this.options.tabIndex),this.options.placeholderText&&this.tagInput.attr("placeholder",this.options.placeholderText),this.options.autocomplete.source||(this.options.autocomplete.source=function(t,e){var i=t.term.toLowerCase(),t=l.grep(this.options.availableTags,function(t){return 0===t.toLowerCase().indexOf(i)});e(t=this.options.allowDuplicates?t:this._subtractArray(t,this.assignedTags()))}),this.options.showAutocompleteOnFocus&&(this.tagInput.focus(function(t,e){i._showAutocomplete()}),void 0===this.options.autocomplete.minLength)&&(this.options.autocomplete.minLength=0),l.isFunction(this.options.autocomplete.source)&&(this.options.autocomplete.source=l.proxy(this.options.autocomplete.source,this)),l.isFunction(this.options.tagSource)&&(this.options.tagSource=l.proxy(this.options.tagSource,this)),this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content ui-corner-all").append(l('<li class="tagit-new"></li>').append(this.tagInput)).click(function(t){var e=l(t.target);e.hasClass("tagit-label")?(e=e.closest(".tagit-choice")).hasClass("removed")||i._trigger("onTagClicked",t,{tag:e,tagLabel:i.tagLabel(e)}):i.tagInput.focus()}),!1);this.options.singleField&&(this.options.singleFieldNode?(t=(e=l(this.options.singleFieldNode)).val().split(this.options.singleFieldDelimiter),e.val(""),l.each(t,function(t,e){i.createTag(e,null,!0),a=!0})):(this.options.singleFieldNode=l('<input type="hidden" style="display:none;" value="" name="'+this.options.fieldName+'" />'),this.tagList.after(this.options.singleFieldNode))),a||this.tagList.children("li").each(function(){l(this).hasClass("tagit-new")||(i.createTag(l(this).text(),l(this).attr("class"),!0),l(this).remove())}),this.tagInput.keydown(function(t){var e;t.which==l.ui.keyCode.BACKSPACE&&""===i.tagInput.val()?(e=i._lastTag(),!i.options.removeConfirmation||e.hasClass("remove")?i.removeTag(e):i.options.removeConfirmation&&e.addClass("remove ui-state-highlight")):i.options.removeConfirmation&&i._lastTag().removeClass("remove ui-state-highlight"),(t.which===l.ui.keyCode.COMMA&&!1===t.shiftKey||t.which===l.ui.keyCode.ENTER||t.which==l.ui.keyCode.TAB&&""!==i.tagInput.val()||t.which==l.ui.keyCode.SPACE&&!0!==i.options.allowSpaces&&('"'!=l.trim(i.tagInput.val()).replace(/^s*/,"").charAt(0)||'"'==l.trim(i.tagInput.val()).charAt(0)&&'"'==l.trim(i.tagInput.val()).charAt(l.trim(i.tagInput.val()).length-1)&&l.trim(i.tagInput.val()).length-1!=0))&&(t.which===l.ui.keyCode.ENTER&&""===i.tagInput.val()||t.preventDefault(),i.options.autocomplete.autoFocus&&i.tagInput.data("autocomplete-open")||(i.tagInput.autocomplete("close"),i.createTag(i._cleanedInput())))}).blur(function(t){i.tagInput.data("autocomplete-open")||i.createTag(i._cleanedInput())}),(this.options.availableTags||this.options.tagSource||this.options.autocomplete.source)&&(l.extend(e={select:function(t,e){return i.createTag(e.item.value),!1}},this.options.autocomplete),e.source=this.options.tagSource||e.source,this.tagInput.autocomplete(e).bind("autocompleteopen.tagit",function(t,e){i.tagInput.data("autocomplete-open",!0)}).bind("autocompleteclose.tagit",function(t,e){i.tagInput.data("autocomplete-open",!1)}),this.tagInput.autocomplete("widget").addClass("tagit-autocomplete"))},destroy:function(){return l.Widget.prototype.destroy.call(this),this.element.unbind(".tagit"),this.tagList.unbind(".tagit"),this.tagInput.removeData("autocomplete-open"),this.tagList.removeClass(["tagit","ui-widget","ui-widget-content","ui-corner-all","tagit-hidden-field"].join(" ")),this.element.is("input")?(this.element.removeClass("tagit-hidden-field"),this.tagList.remove()):(this.element.children("li").each(function(){l(this).hasClass("tagit-new")?l(this).remove():(l(this).removeClass(["tagit-choice","ui-widget-content","ui-state-default","ui-state-highlight","ui-corner-all","remove","tagit-choice-editable","tagit-choice-read-only"].join(" ")),l(this).text(l(this).children(".tagit-label").text()))}),this.singleFieldNode&&this.singleFieldNode.remove()),this},_cleanedInput:function(){return l.trim(this.tagInput.val().replace(/^"(.*)"$/,"$1"))},_lastTag:function(){return this.tagList.find(".tagit-choice:last:not(.removed)")},_tags:function(){return this.tagList.find(".tagit-choice:not(.removed)")},assignedTags:function(){var t=this,e=[];return this.options.singleField?""===(e=l(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter))[0]&&(e=[]):this._tags().each(function(){e.push(t.tagLabel(this))}),e},_updateSingleTagsField:function(t){l(this.options.singleFieldNode).val(t.join(this.options.singleFieldDelimiter)).trigger("change")},_subtractArray:function(t,e){for(var i=[],a=0;a<t.length;a++)-1==l.inArray(t[a],e)&&i.push(t[a]);return i},tagLabel:function(t){return this.options.singleField?l(t).find(".tagit-label:first").text():l(t).find("input:first").val()},_showAutocomplete:function(){this.tagInput.autocomplete("search","")},_findTagByLabel:function(e){var i=this,a=null;return this._tags().each(function(t){if(i._formatStr(e)==i._formatStr(i.tagLabel(this)))return a=l(this),!1}),a},_isNew:function(t){return!this._findTagByLabel(t)},_formatStr:function(t){return this.options.caseSensitive?t:l.trim(t.toLowerCase())},_effectExists:function(t){return Boolean(l.effects&&(l.effects[t]||l.effects.effect&&l.effects.effect[t]))},createTag:function(t,e,i){var a,s,o,n=this;return t=l.trim(t),""!==(t=this.options.preprocessTag?this.options.preprocessTag(t):t)&&(this.options.allowDuplicates||this._isNew(t)?this.options.tagLimit&&this._tags().length>=this.options.tagLimit?(this._trigger("onTagLimitExceeded",null,{duringInitialization:i}),!1):(a=l(this.options.onTagClicked?'<a class="tagit-label"></a>':'<span class="tagit-label"></span>').text(t),this.options.tagName&&a.attr("name",this.options.tagName),s=l("<li></li>").addClass("tagit-choice ui-widget-content ui-state-default ui-corner-all").addClass(e).append(a),this.options.readOnly?s.addClass("tagit-choice-read-only"):(s.addClass("tagit-choice-editable"),e=l("<span></span>").addClass("ui-icon ui-icon-close"),o=l('<a><span class="text-icon">Ã—</span></a>').attr("role","button").attr("aria-label",a.text()+" close").addClass("tagit-close").append(e).click(function(t){n.removeTag(s)}),s.append(o)),null!=this.options.tabIndex&&(o.attr("tabindex",this.options.tabIndex),o.keypress(function(t){t.which!==l.ui.keyCode.ENTER&&t.which!==l.ui.keyCode.SPACE||(n.removeTag(s),n.tagInput.focus())})),this.options.singleField||(e=a.html(),s.append('<input type="hidden" value="'+e+'" name="'+this.options.fieldName+'" class="tagit-hidden-field" />')),void(!1!==this._trigger("beforeTagAdded",null,{tag:s,tagLabel:this.tagLabel(s),duringInitialization:i})&&(this.options.singleField&&((o=this.assignedTags()).push(t),this._updateSingleTagsField(o)),this._trigger("onTagAdded",null,s),this.tagInput.val(""),this.tagInput.parent().before(s),this._trigger("afterTagAdded",null,{tag:s,tagLabel:this.tagLabel(s),duringInitialization:i}),this.options.showAutocompleteOnFocus)&&!i&&setTimeout(function(){n._showAutocomplete()},0))):(a=this._findTagByLabel(t),!1!==this._trigger("onTagExists",null,{existingTag:a,duringInitialization:i})&&this._effectExists("highlight")&&a.effect("highlight"),!1))},removeTag:function(t,e){var i,a,s;e=void 0===e?this.options.animate:e,t=l(t),this._trigger("onTagRemoved",null,t),!1!==this._trigger("beforeTagRemoved",null,{tag:t,tagLabel:this.tagLabel(t)})&&(this.options.singleField&&(a=this.assignedTags(),i=this.tagLabel(t),a=l.grep(a,function(t){return t!=i}),this._updateSingleTagsField(a)),e?(t.addClass("removed"),a=this._effectExists("blind")?["blind",{direction:"horizontal"},"fast"]:["fast"],s=this,a.push(function(){t.remove(),s._trigger("afterTagRemoved",null,{tag:t,tagLabel:s.tagLabel(t)})}),t.fadeOut("fast").hide.apply(t,a).dequeue()):(t.remove(),this._trigger("afterTagRemoved",null,{tag:t,tagLabel:this.tagLabel(t)})))},removeTagByLabel:function(t,e){var i=this._findTagByLabel(t);if(!i)throw"No such tag exists with the name '"+t+"'";this.removeTag(i,e)},removeAll:function(){var i=this;this._tags().each(function(t,e){i.removeTag(e,!1)})}})}(jQuery);