<div class="container manage-page marginBottom">
    <div class="cb-box row">
        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 hidden-xs">
            {include file="$style_dir/blocks/manage/userMenuLeft.html"}
        </div>
        <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">
            <div class="tabbable">
                <ul class="nav nav-tabs" id="myTab">


    {if in_array($mode, ['profile_settings', 'block_users'])}

                    {if config('channelsSection') == 'yes' && !$current_enable_channel_page}
                        <li class="{if $mode=='profile_settings'}active{/if}">
                            <a href="/edit_account.php?mode=profile">
                                <h5>{lang code='channel_profile_settings'}</h5>
                            </a>
                        </li>
                        <li class="{if $mode =='block_users'}active{/if}">
                            <a href="/edit_account.php?mode=block_users">
                                <h5>{lang code='block_users'}</h5>
                            </a>
                        </li>
                    {/if}
                </ul>
                <br>
                <form method="post" class="accountForm">
                    <div class="tab-content clearfix">
                        <div id="cpsetting" class="tab-pane{if $mode=='profile_settings'} active{/if}">
                            {include file="$style_dir/blocks/my_account/channel_settings.html"}
                        </div>
                        {if config('enable_membership') == 'yes' && !empty($memberships)}
                            <div id="menu_membership" class="tab-pane {if $mode =='membership'}active{/if}">
                                {if $need_to_active_membership && $can_renew_membership}
                                    <h2>{lang code='renew_membership'}</h2>
                                    <button class="btn-primary btn mb-2">{lang('renew')}</button>
                                {/if}
                                {if $need_to_active_membership}
                                    <h2>{lang code='available_memberships'}</h2>
                                    <table class="table table-bordered table-striped">
                                        <tr>
                                            <th class="col-md-2">{lang('user_level')}</th>
                                            <th class="col-md-2">{lang('frequency')}</th>
                                            <th class="col-md-2">{lang('base_price')}</th>
                                            <th class="col-md-2">{lang('storage_quota')}</th>
                                            <th class="col-md-2">{lang('storage_price')}</th>
                                        </tr>
                                        {foreach from=$available_memberships item=membership}
                                            <tr>
                                                <td>{$membership.user_level_name}</td>
                                                <td>{lang('frequency_'|cat:$membership.frequency)}</td>
                                                <td>
                                                    {if $membership.base_price != 0}
                                                        {$membership.base_price} {$membership.symbol}
                                                    {else}
                                                        {lang('free')}
                                                    {/if}
                                                </td>
                                                <td>
                                                    {if $membership.storage_quota_included != 0}
                                                        {$membership.storage_quota_included} {lang('gb')}
                                                    {else}
                                                        {lang('none')}
                                                    {/if}
                                                </td>
                                                <td>
                                                    {if $membership.storage_price_per_go != 0}
                                                        {$membership.storage_price_per_go} {$membership.symbol} {lang('per_gb')}
                                                    {else}
                                                        {lang('free')}
                                                    {/if}
                                                </td>
                                            </tr>
                                        {/foreach}
                                    </table>
                                {/if}
                                <h2>{lang code='membership_history'}</h2>
                                <table class="table table-bordered table-striped">
                                    <tr>
                                        <th class="col-md-2" style="cursor:pointer;">{lang('date_start')} </th>
                                        <th class="col-md-2" style="cursor:pointer;">{lang('date_end')}</th>
                                        <th class="col-md-2" style="cursor:pointer;">{lang('status')}</th>
                                        <th class="col-md-2" style="cursor:pointer;">{lang('user_levels')}</th>
                                        <th class="col-md-1" style="cursor:pointer;">{lang('price')}</th>
                                        {if config('enable_storage_history' == 'yes')}
                                            <th class="col-md-2" style="cursor:pointer;">{lang('max_period_storage')}</th>
                                        {/if}
                                    </tr>
                                    {section name=sub loop=$memberships}
                                        <tr>
                                            <td><span>{display_clean($memberships[sub].date_start)}</span></td>
                                            <td><span>{if $memberships[sub].date_end}{display_clean($memberships[sub].date_end)}{else}{lang('never')}{/if}</span></td>
                                            <td><span>{lang($memberships[sub].language_key_title)}</span></td>
                                            <td><span>{lang($memberships[sub].user_level_name|strtolower|replace:' ':'_')} - {lang('frequency_'|cat:$memberships[sub].frequency)}</span></td>
                                            <td><span>{display_clean($memberships[sub].price)} {display_clean($memberships[sub].symbol)}</span></td>
                                            {if config('enable_storage_history' == 'yes')}
                                                {if $memberships[sub].date_end  == null}{assign var=date_end value='2999-01-01 00:00:00'}{else}{assign var=date_end value=$memberships[sub].date_end}{/if}
                                                <td><span>{System::get_readable_filesize(User::getInstance()->getPeriodMaxStorageUseByUser($memberships[sub].userid, $memberships[sub].date_start, $date_end),2)}</span></td>
                                            {/if}
                                        </tr>
                                    {/section}
                                </table>
                            </div>
                        {/if}
                    </div>

                    <div id="busers" class="tab-pane {if $mode =='block_users'}active {/if}">
                        {include file="$style_dir/blocks/my_account/channel_block_users.html"}
                    </div>
                </form>
            </div>
        </div>
    </div>
    {else if in_array($mode, ['account_settings', 'avatar_bg', 'change_email', 'change_password', 'subs'])}
                    <li class="{if $mode=='account_settings'}active{/if}">
                        <a href="/edit_account.php?mode=account">
                            <h5>{lang code='account_settings'}</h5>
                        </a>
                    </li>
                    <li class="{if $mode =='change_password'}active{/if}">
                        <a href="/edit_account.php?mode=change_password">
                            <h5>{lang code='user_change_pass'}</h5>
                        </a>
                    </li>
                    <li class="{if $mode =='change_email'}active{/if}">
                        <a href="/edit_account.php?mode=change_email">
                            <h5>{lang code='user_change_email'}</h5>
                        </a>
                    </li>
                    {if (config('picture_upload') == 'yes' && has_access('avatar_upload')) || config('picture_url') == 'yes' || !empty(User::getInstance()->get('avatar_url')) || !empty(User::getInstance()->get('avatar'))}
                    <li class="{if $mode =='avatar_bg'}active{/if}">
                        <a href="/edit_account.php?mode=avatar_bg">
                            <h5>{lang code='change_avatar'}</h5>
                        </a>
                    </li>
                    {/if}
                    {if config('channelsSection') == 'yes' && has_access('view_channels')}
                    <li class="{if $mode =='subs'}active{/if}">
                        <a href="/edit_account.php?mode=subscriptions">
                            <h5>{lang code='com_manage_subs'}</h5>
                        </a>
                    </li>
                    {/if}
                </ul>
                <br/>
                <div class="tab-content clearfix">
                    <div id="asettings" class="tab-pane {if $mode=='account_settings'}active{/if}">
                        {include file="$style_dir/blocks/my_account/account_settings.html"}
                    </div>

                    <div id="cpassword" class="tab-pane {if $mode =='change_password'}active {/if}">
                        {include file="$style_dir/blocks/my_account/account_change_password.html"}
                    </div>
                    <div id="cemail" class="tab-pane {if $mode =='change_email'}active {/if}">
                        {include file="$style_dir/blocks/my_account/account_change_email.html"}
                    </div>
                    {if (config('picture_upload') == 'yes' && has_access('avatar_upload')) || config('picture_url') == 'yes' || !empty(User::getInstance()->get('avatar_url')) || !empty(User::getInstance()->get('avatar'))}
                    <div id="uavatar" class="tab-pane {if $mode=='avatar_bg'}active{/if}">
                        {include file="$style_dir/blocks/my_account/account_change_avatar.html"}
                    </div>
                    {/if}

                    {if config('channelsSection') == 'yes' && has_access('view_channels')}
                    <div id="msubscription" class="tab-pane {if $mode =='subs'}active{/if}">
                        {include file="$style_dir/blocks/my_account/account_manage_subscriptions.html"}
                    </div>
                    {/if}
                </div>
            </div>
        </div>
    </div>
    {/if}
</div>

<script>
    {if config('enable_user_dob_edition') == 'yes'}
        let format_date_js = '{get_date_js()}';
        let lang = '{$lang_obj->getLang()}';
    {/if}

    let available_tags = JSON.parse('{$available_tags|json_encode|replace:"'": "\'"}');

    let mode = "{$on}";

    let user_about_me = "{base64_encode($user['about_me'])}";
    let user_profile_desc = "{base64_encode($user['profile_desc'])}";
    {if config('enable_user_schools')=='yes'}
    let user_schools = "{base64_encode($user['schools'])}";
    {/if}
    {if config('enable_user_occupation')=='yes'}
    let user_occupation = "{base64_encode($user['occupation'])}";
    {/if}
    {if config('enable_user_compagnies')=='yes'}
    let user_companies = "{base64_encode($user['companies'])}";
    {/if}
    {if config('enable_user_hobbies')=='yes'}
    let user_hobbies = "{base64_encode($user['hobbies'])}";
    {/if}
    {if config('enable_user_favorite_movies')=='yes'}
    let user_movies = "{base64_encode($user['fav_movies'])}";
    {/if}
    {if config('enable_user_favorite_music')=='yes'}
    let user_music = "{base64_encode($user['fav_music'])}";
    {/if}
    {if config('enable_user_favorite_books')=='yes'}
    let user_books = "{base64_encode($user['fav_books'])}";
    {/if}
</script>
