var eventSource,max_try=5;function updateListeners(){$(".update_core").on("click",function(){update("core")}),$(".update_db").on("click",function(){update("db")}),$(".launch_wip").on("click",function(){showSpinner(),$.ajax({url:"/actions/admin_launch_wip.php",type:"post",dataType:"json",success:function(e){hideSpinner(),0==e.success&&$(".page-content").prepend(e.msg);var t=$(".launch_wip").parents(".alert"),n=t.parent();t.remove(),n.append(e.template),updateListeners()}})})}$(document).ready(function(){var a="/admin_area/index.php";function o(t){$.post(a,{mode:"delete_note",id:t},function(e){$("#note-"+t).slideUp()},"text")}$(".oneNote .delete").on({click:function(e){e.preventDefault(),o($(this).parent().attr("id")),$(this).parents("li").remove()}}),$("#add_new_note").on({click:function(e){e.preventDefault();let s=$(this).parents(".addNote").find("textarea").val();s?($(this).parents(".addNote").find("textarea").val(""),$.post(a,{mode:"add_note",note:s},function(e){var t=document.createElement("li"),n=(t.className="col-md-4",document.createElement("a")),a=(n.className="delete",n.href="#",n.innerHTML="x",document.createElement("p"));a.id=e.id,a.innerHTML=$("<textarea/>").text(s).html(),a.className="oneNote",$(a).append(n),$(t).append(a),$(n).on({click:function(e){e.preventDefault(),o($(this).parent().attr("id")),$(this).parents("li").remove()}}),$(".notesList").prepend(t)},"json")):alert("Please enter something")}}),$("#addTodo").on({click:function(e){e.preventDefault();e=$(this).parents(".addTodo").find("input").val();e.length?($(this).parents(".addTodo").find("input").val(""),$.ajax({url:a,type:"post",data:{val:e,mode:"add_todo"},success:function(e){e=$.parseJSON(e);var t=document.createElement("li"),n=(t.className="col-md-12 oneTodo",document.createElement("span")),e=(n.className="paddingLeftSmall col-md-10",n.id=e.id,n.innerHTML=e.todo,document.createElement("a"));e.href="#",e.className="btn btn-danger btn-xs delete col-md-2",e.innerHTML=lang_delete,$(e).on("click",function(e){e.preventDefault();var t=this,e=$(this).prev().attr("id");$.ajax({url:a,type:"post",data:{id:e,mode:"delete_todo"},success:function(e){$(t).parents("li").remove()}})}),$(t).append(n).append(e),$(".todosList").prepend(t)}})):alert("Please enter a valid value")}}),$("#todolist .delete").on("click",function(e){e.preventDefault(),$.ajax({url:a,type:"post",data:{id:$(this).prev().attr("id"),mode:"delete_todo"},success:function(e){this.parents("li").remove()}})}),$("#todolist").on("click",".editable-clear-x",function(e){e.preventDefault();let t=$(this).parents(".editable-container").prev().attr("id");t=(t=t.match(/([0-9]+)$/g)).pop(),$.ajax({url:"/admin_area/index.php",type:"post",data:{id:t,mode:"delete_todo"},success:function(e){$(this).parents("p").remove(),$(this).parents(".editable-container").remove()}}),e.stopPropagation()}),"true"===can_sse&&"true"===is_update_processing&&connectSSE(),updateListeners()});let showMsg=function(e,t,n){let a="ajax_msg_"+(Math.random()+1).toString(36).substring(7);$("#update_div").append('<div role="alert" id="'+a+'" class="alert alert-'+t+' alert-dismissible">    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">Ã—</span></button>    <div class="msg">'+e+"</div></div>"),!0===n&&setTimeout(function(){$("#"+a).addClass("hidden")},5e3)};function update(e){$(".launch_wip").off("click").prop("disabled","disabled"),$.ajax({url:"/actions/admin_launch_update.php",type:"post",data:{type:e},success:function(e){let t;try{t=JSON.parse(e)}catch(e){t.success=!1}if(!0!==t.success){let e=lang.technical_error;void 0!==t.error_msg&&null!=t.error_msg&&""!=t.error_msg&&(e=t.error_msg),void showMsg(e,"danger")}else connectSSE()}})}function connectSSE(){var t=0;(eventSource=new EventSource("/admin_area/sse/update_info.php")).addEventListener("message",function(e){e=JSON.parse(e.data);$("#update_div").html(e.html),updateListeners(),"false"===e.is_updating?(eventSource.close(),checkStatus()):$(".launch_wip").off("click")}),eventSource.addEventListener("open",function(e){max_try<++t&&eventSource.close()},!1),eventSource.addEventListener("error",function(e){eventSource.close()},!1)}function checkStatus(){$.ajax({url:"/actions/admin_check_update.php",type:"post",dataType:"json",success:function(e){$("#status_icon").find("span").removeClass(),$("#status_icon").find("span").addClass("status-"+e.status),$("#status_html").html(e.html)}})}