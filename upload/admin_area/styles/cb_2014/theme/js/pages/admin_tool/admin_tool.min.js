var eventSource,max_try=5;function connectSSE(){var e=0;(eventSource=new EventSource("/admin_area/sse/progress_tool.php")).addEventListener("message",function(e){var t=JSON.parse(e.data),a=[];t.forEach(function(e){$("#progress-bar-"+e.id).attr("aria-valuenow",e.pourcent).width(e.pourcent+"%"),$("#pourcent-"+e.id).html(e.pourcent),$("#done-"+e.id).html(e.elements_done),$("#total-"+e.id).html(e.elements_total),a.push(e.id)}),$(".progress-bar:visible").each(function(e,t){let s=(t=$(t)).attr("data-id");a.includes(s)||(t.addClass("progress-bar-success"),t.width("100%"),$(".launch[data-id="+s+"]").parent().removeClass("disabled"),$(".stop[data-id="+s+"]").parent().addClass("disabled"),$("#span-"+s).html(lang.completed),$("#progress-bar-"+s).attr("aria-valuenow",100).width("100%"),$("#done-"+s).html($("#total-"+s).html()),$("#pourcent-"+s).html(100),setTimeout(function(){$("#progress-"+s).hide(),$("#span-"+s).html(lang.ready),$("#progress-bar-"+s).removeClass("progress-bar-success").attr("aria-valuenow",0).width("0%"),$("#pourcent-"+s).html(0),$("#done-"+s).html(0),$("#total-"+s).html(0)},1e4))})},!1),eventSource.addEventListener("open",function(t){++e>max_try&&eventSource.close()},!1),eventSource.addEventListener("error",function(e){eventSource.close()},!1)}$(function(){connectSSE(),$(".launch").on("click",function(){var e=$(this);if(!e.parent().hasClass("disabled")){var t=$(this).data("id");$.ajax({url:"/actions/launch_tool.php",type:"POST",data:{id_tool:t},dataType:"json",success:function(a){$("#progress-"+t).show(),$("#progress-bar-"+t).removeClass("progress-bar-success").attr("aria-valuenow",0).width("0%"),$("#span-"+t).html(a.libelle_status),$("#pourcent-"+t).html(0),$("#done-"+t).html(0),$("#total-"+t).html(0),$(".page-content").prepend(a.msg),e.parent().addClass("disabled"),$('.stop[data-id="'+t+'"]').parent().removeClass("disabled")}})}}),$(".stop").on("click",function(){var e=$(this);if(!$(this).parent().hasClass("disabled")){var t=e.data("id");$.ajax({url:"/actions/stop_tool.php",type:"POST",data:{id_tool:t},dataType:"json",success:function(a){$("#span-"+t).html(a.libelle_status),e.parent().addClass("disabled"),$(".page-content").prepend(a.msg),eventSource.close()}})}})});