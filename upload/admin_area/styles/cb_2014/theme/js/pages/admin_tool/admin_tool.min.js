var eventSource,max_try=5;function connectSSE(){var a=0;(eventSource=new EventSource("/admin_area/sse/progress_tool.php")).addEventListener("message",function(e){var e=JSON.parse(e.data),s=(console.log(e),[]);e.forEach(function(e){$("#progress-bar-"+e.id).attr("aria-valuenow",e.pourcent).width(e.pourcent+"%"),$("#pourcent-"+e.id).html(e.pourcent),$("#done-"+e.id).html(e.elements_done),$("#total-"+e.id).html(e.elements_total),s.push(e.id)}),$(".progress-bar:visible").each(function(e,a){let t=(a=$(a)).attr("data-id");s.includes(t)||(a.addClass("progress-bar-success"),a.width("100%"),$(".launch[data-id="+t+"]").parent().removeClass("disabled"),$(".stop[data-id="+t+"]").parent().addClass("disabled"),$("#span-"+t).html(lang.complete),setTimeout(function(){$("#progress-"+t).hide(),$("#span-"+t).html(lang.ready)},1e4))})},!1),eventSource.addEventListener("open",function(e){console.log("opened"),max_try<++a&&eventSource.close()},!1),eventSource.addEventListener("error",function(e){eventSource.close()},!1)}$(function(){connectSSE(),$(".launch").on("click",function(){var a,t=$(this);t.parent().hasClass("disabled")||(a=$(this).data("id"),$.ajax({url:"/actions/launch_tool.php",type:"POST",data:{id_tool:a},dataType:"json",success:function(e){$("#progress-"+a).show(),$("#progress-bar-"+a).attr("aria-valuenow",0),$("#span-"+a).html(e.libelle_status),$(".page-content").prepend(e.msg),t.parent().addClass("disabled"),$('.stop[data-id="'+a+'"]').parent().removeClass("disabled")}}))}),$(".stop").on("click",function(){var a,t=$(this);$(this).parent().hasClass("disabled")||(a=t.data("id"),$.ajax({url:"/actions/stop_tool.php",type:"POST",data:{id_tool:a},dataType:"json",success:function(e){$("#span-"+a).html(e.libelle_status),t.parent().addClass("disabled"),$(".page-content").prepend(e.msg),eventSource.close()}}))})});