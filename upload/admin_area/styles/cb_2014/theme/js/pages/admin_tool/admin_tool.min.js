var eventSource,max_try=5;function connectSSE(){var t=0;(eventSource=new EventSource("/actions/progress_tool.php")).addEventListener("message",function(e){var e=JSON.parse(e.data),s=(console.log(e),[]);e.forEach(function(e){$("#progress-bar-"+e.id).attr("aria-valuenow",e.pourcent).width(e.pourcent+"%"),$("#pourcent-"+e.id).html(e.pourcent),$("#done-"+e.id).html(e.elements_done),$("#total-"+e.id).html(e.elements_total),s.push(e.id)}),$(".progress-bar:visible").each(function(e,t){let a=(t=$(t)).attr("data-id");s.includes(a)||(t.addClass("progress-bar-success"),t.width("100%"),$(".launch[data-id="+a+"]").parent().removeClass("disabled"),$(".stop[data-id="+a+"]").parent().addClass("disabled"),$("#span-"+a).html(lang.complete),setTimeout(function(){$("#progress-"+a).hide(),$("#span-"+a).html(lang.ready)},1e4))})},!1),eventSource.addEventListener("open",function(e){console.log("opened"),max_try<++t&&eventSource.close()},!1),eventSource.addEventListener("error",function(e){eventSource.close()},!1)}$(function(){connectSSE(),$(".launch").on("click",function(){var t,a=$(this);a.parent().hasClass("disabled")||(t=$(this).data("id"),$.ajax({url:"/actions/launch_tool.php",type:"POST",data:{id_tool:t},dataType:"json",success:function(e){$("#progress-"+t).show(),$("#progress-bar-"+t).attr("aria-valuenow",0),$("#span-"+t).html(e.libelle_status),$(".page-content").prepend(e.msg),a.parent().addClass("disabled"),$('.stop[data-id="'+t+'"]').parent().removeClass("disabled")}}))}),$(".stop").on("click",function(){var t,a=$(this);$(this).parent().hasClass("disabled")||(t=a.data("id"),$.ajax({url:"/actions/stop_tool.php",type:"POST",data:{id_tool:t},dataType:"json",success:function(e){$("#span-"+t).html(e.libelle_status),a.parent().addClass("disabled"),$(".page-content").prepend(e.msg),eventSource.close()}}))})});