var eventSource,max_try=2;function regenerateThumbs(e){$.ajax({url:admin_url+"actions/thumbs_regenerate.php",type:"post",data:{videoid:e},dataType:"json",beforeSend:function(){showSpinner(),$("#auto_thumbs .tools-bottom").hide()},success:function(e){$("#thumb_list").html(e.template),$(".page-content").prepend(e.msg),connectSSE(),hideSpinner()}})}function delete_thumb(e,t,n){$.ajax({url:admin_url+"actions/thumbs_delete.php",type:"post",dataType:"json",data:{videoid:e,num:t,type:n}}).done(function(e){$("#thumb_list").html(e.template)}).always(function(e){$(".page-content").prepend(e.msg)})}function connectSSE(){if("true"!==can_sse)return;let e=0;(eventSource=new EventSource(admin_url+"sse/progress_generate_thumb.php?id_video="+video_id)).addEventListener("message",function(e){var t=JSON.parse(e.data);$("#thumb_list").html(t.html),t.is_max_thumb?($(".alert-dismissable .close").trigger("click"),eventSource.close(),$(".page-content").prepend(t.msg)):$("#auto_thumbs .tools-bottom").hide()},!1),eventSource.addEventListener("open",function(t){++e>max_try&&eventSource.close()},!1),eventSource.addEventListener("error",function(e){eventSource.close()},!1)}
