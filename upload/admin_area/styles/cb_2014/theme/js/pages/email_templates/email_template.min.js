function editEmailTemplate(e){showSpinner(),$.post({url:"/actions/admin_email_template_edit.php",data:{id_email_template:e},dataType:"json",success:e=>{$("#email_template > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailTemplateEdit()}}).always(()=>hideSpinner())}function editEmail(e){showSpinner(),$.post({url:"/actions/admin_email_edit.php",data:{id_email:e},dataType:"json",success:e=>{$("#email > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailEdit()}}).always(()=>hideSpinner())}function saveEmailTemplate(e){showSpinner(),$.post({url:"/actions/admin_email_template_save.php",data:e.serialize(),dataType:"json",success:e=>{$("#email_template > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailTemplateEdit()}}).always(()=>hideSpinner())}function saveEmail(e){showSpinner(),$.post({url:"/actions/admin_email_save.php",data:e.serialize(),dataType:"json",success:e=>{$("#email > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailEdit()}}).always(()=>hideSpinner())}function deleteEmailTemplate(e){showSpinner(),$.post({url:"/actions/admin_email_template_delete.php",data:{id_email_template:e},dataType:"json",success:e=>{$(".page-content").prepend(e.msg),listEmailTemplate()}})}function deleteEmail(e){showSpinner(),$.post({url:"/actions/admin_email_delete.php",data:{id_email:e},dataType:"json",success:e=>{$(".page-content").prepend(e.msg),listEmail()}})}function listEmailTemplate(){showSpinner(),$.post({url:"/actions/admin_email_template_list.php",dataType:"json",success:e=>{$("#email_template > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailTemplateList()}}).always(()=>hideSpinner())}function listEmail(){showSpinner(),$.post({url:"/actions/admin_email_list.php",dataType:"json",success:e=>{$("#email > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailList()}}).always(()=>hideSpinner())}$(function(){initListenerEmailTemplateList(),initListenerEmailList(),initListenerEmailTester()});var timeout,delay=500;function initListenerEmailTemplateEdit(){$("#email_template_content").off("keyup").on("keyup",function(){var e=$(this);clearTimeout(timeout),timeout=setTimeout(()=>{$("#render").html(e.val())},delay)}),$("#email_template_edit").off("submit").on("submit",function(e){e.preventDefault(),saveEmailTemplate($(this))}),$(".back_to_template_list").off("click").on("click",()=>{listEmailTemplate()})}function initListenerEmailTemplateList(){$(".add_new_email_template_list").off("click").on("click",()=>{editEmailTemplate()}),$('input[name="make_default"]').change(function(e){confirm(confirm_default_template)?(showSpinner(),$('input[name="make_default"]').not(this).prop("checked",!1),$.post({url:"/actions/admin_email_make_default.php",data:$("#default_template").serialize(),dataType:"json",success:function(e){$("#email_template > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailTemplateList()}}).always(()=>hideSpinner())):$(this).prop("checked",!1)})}function initListenerEmailEdit(){$("#email_content").off("keyup").on("keyup",function(){var e=$(this);clearTimeout(timeout),timeout=setTimeout(()=>{$("#render_email").html(e.val())},delay)}),$("#email_edit").off("submit").on("submit",function(e){e.preventDefault(),saveEmail($(this))}),$(".back_to_email_list").off("click").on("click",()=>{listEmail()})}function initListenerEmailList(){$(".add_new_email_list").off("click").on("click",()=>{editEmail()})}function displayVariable(e){showSpinner(),$.post({url:"/actions/admin_display_variables.php",dataType:"json",data:{id_email:e},success:function(e){$("#edit_variable").html(e.template),$(".page-content").prepend(e.msg)}}).always(()=>hideSpinner())}function initListenerEmailTester(){$("#select_email").off("change").on("change",function(){displayVariable($(this).val())}),$(".send_email").off("click").on("click",function(e){e.preventDefault(),hideSpinner(),$.post({url:"/actions/admin_email_tester_send.php",dataType:"json",data:$("#email_tester_form").serialize(),success:function(e){$(".page-content").prepend(e.msg)}}).always(()=>hideSpinner())})}