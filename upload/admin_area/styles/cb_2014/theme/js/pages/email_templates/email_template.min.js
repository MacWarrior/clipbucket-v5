function editEmailTemplate(e){showSpinner(),$.post({url:"/actions/admin_email_template_edit.php",data:{id_email_template:e},dataType:"json",success(e){$("#email_template > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailTemplateEdit()}}).always(()=>hideSpinner())}function editEmail(e){showSpinner(),$.post({url:"/actions/admin_email_edit.php",data:{id_email:e},dataType:"json",success(e){$("#email > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailEdit()}}).always(()=>hideSpinner())}function saveEmailTemplate(e){showSpinner(),$.post({url:"/actions/admin_email_template_save.php",data:e.serialize(),dataType:"json",success(e){$("#email_template > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailTemplateEdit(),updateSelect("email_id_email_template",e.email_template_list,"email_template")}}).always(()=>hideSpinner())}function saveEmail(e){showSpinner(),$.post({url:"/actions/admin_email_save.php",data:e.serialize(),dataType:"json",success(e){$("#email > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailEdit(),updateSelect("select_email",e.email_list,"email")}}).always(()=>hideSpinner())}function deleteEmailTemplate(e){showSpinner(),$.post({url:"/actions/admin_email_template_delete.php",data:{id_email_template:e},dataType:"json",success(e){$(".page-content").prepend(e.msg),listEmailTemplate(),updateSelect("email_id_email_template",e.email_template_list,"email_template")}})}function deleteEmail(e){showSpinner(),$.post({url:"/actions/admin_email_delete.php",data:{id_email:e},dataType:"json",success(e){$(".page-content").prepend(e.msg),listEmail(),updateSelect("select_email",e.email_list,"email")}})}function listEmailTemplate(){showSpinner(),$.post({url:"/actions/admin_email_template_list.php",dataType:"json",success(e){$("#email_template > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailTemplateList()}}).always(()=>hideSpinner())}function listEmail(e){showSpinner(),$.post({url:"/actions/admin_email_list.php",dataType:"json",data:{search:e},success(e){$("#email > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailList()}}).always(()=>hideSpinner())}$(function(){initListenerEmailTemplateList(),initListenerEmailList(),initListenerEmailTester()});var timeout,delay=500;function initListenerEmailTemplateEdit(){$("#email_template_content").on("keyup",function(){let e=$(this).val();clearTimeout(timeout),timeout=setTimeout(()=>{$.post({url:"/actions/admin_email_template_render.php",data:{email_content:e},dataType:"json",success(e){$("#render").html(e.email_render)}})},delay)}),$("#email_template_edit").on("submit",function(e){e.preventDefault(),saveEmailTemplate($(this))}),$(".back_to_template_list").on("click",()=>{listEmailTemplate()})}function initListenerEmailTemplateList(){$(".add_new_email_template_list").on("click",()=>{editEmailTemplate()}),$('input[name="make_default"]').change(function(e){confirm(confirm_default_template)?(showSpinner(),$('input[name="make_default"]').not(this).prop("checked",!1),$.post({url:"/actions/admin_email_make_default.php",data:$("#default_template").serialize(),dataType:"json",success:function(e){$("#email_template > .row").html(e.template),$(".page-content").prepend(e.msg),initListenerEmailTemplateList()}}).always(()=>hideSpinner())):$(this).prop("checked",!1)})}function initListenerEmailEdit(){$("#email_id_email_template").on("change",function(){refreshRenderEmail()}),$("#email_content").on("keyup",function(){refreshRenderEmail()}),$("#email_edit").on("submit",function(e){e.preventDefault(),saveEmail($(this))}),$(".back_to_email_list").on("click",()=>{listEmail()})}function refreshRenderEmail(){let e=$("#email_content").val(),t=$("#email_id_email_template").val();clearTimeout(timeout),timeout=setTimeout(()=>{$.post({url:"/actions/admin_email_render.php",data:{email_content:e,id_email_template:t},dataType:"json",success(e){$("#render_email").html(e.email_render)}})},delay)}function initListenerEmailList(){$(".add_new_email_list").on("click",()=>{editEmail()}),$(".search_email").on("click",()=>{listEmail($("#search").val())})}function displayVariable(e){showSpinner(),$.post({url:"/actions/admin_display_variables.php",dataType:"json",data:{id_email:e},success:function(e){$("#edit_variable").html(e.template),$(".page-content").prepend(e.msg)}}).always(()=>hideSpinner())}function initListenerEmailTester(){$("#select_email").on("change",function(){displayVariable($(this).val())}),$(".send_email").on("click",function(e){e.preventDefault(),hideSpinner(),$.post({url:"/actions/admin_email_tester_send.php",dataType:"json",data:$("#email_tester_form").serialize(),success:function(e){$(".page-content").prepend(e.msg)}}).always(()=>hideSpinner())})}function updateSelect(e,t,a){var i,l;$("#"+e+" option").remove(),$.each(t,function(t,n){"email"==a?(i=n.id_email,l=n.code+" - "+n.title):"email_template"==a&&(i=n.id_email_template,l=n.code),$("#"+e).append($("<option>",{value:i,text:l}))})}
