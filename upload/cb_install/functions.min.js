var ajax_url="./ajax.php";function dbconnect(){$("#loading").html('<img src="./images/loading.gif"/>');var e=$("#installation").serialize();$.post(ajax_url,e,function(e){e.err?($("#dbresult").show().html(e.err),$("#loading").html("")):$("#installation").submit()},"json")}function dodatabase(e){var t=$("#installation").serialize();t+="&step="+e,$.post(ajax_url,t,function(e){e.msg&&$("#dbresult").show().append(e.msg),e.err&&($(".errorDiv").show().append(e.err),$("#loading").attr("src","images/cross_arrow.png")),e.status&&$("#current").html(e.status),"forward"==e.step&&$("#installation").submit(),e.step&&"forward"!=e.step&&dodatabase(e.step)},"json")}function password(e,t){var r,s=0,a="";if(void 0==t)var t=!1;for(;s<e;)r=Math.floor(100*Math.random())%94+33,(t||(!(r>=33)||!(r<=47))&&(!(r>=58)||!(r<=64))&&(!(r>=91)||!(r<=96))&&(!(r>=123)||!(r<=126)))&&(s++,a+=String.fromCharCode(r));return a}function newpassword(){var e=password(8,!0);$("#genPass").html(e),$("#password").val(e)}function checkBeforeSubmit(e){var t=!1;if(e?confirm("Do you really want do go further without updating ?")&&(t=!0):t=!0,!t)return!1;$("#installation").trigger("submit")}$(document).ready(function(){$("[id^='skip_']").change(function(){this.checked?($(this).parent().find("[id$='_filepath']").val("").prop("disabled",!0),$(this).parent().find("[id$='_filepath_test']").addClass("disabled")):($(this).parent().find("[id$='_filepath']").prop("disabled",!1),$(this).parent().find("[id$='_filepath_test']").removeClass("disabled"))}),$("[id$='_filepath_test']").click(function(){$("#mode").val("precheck"),$("#installation").submit()});var e=$(".check_timezone");e.length>0&&($(".btn-primary").prop("disabled",!0),e.on("change",function(t){$(".alert-dismissable").remove(),$(e).removeClass("has-error"),$("#timezone").next(".select2-container").removeClass("has-error"),$("#spinner-content").show(),$.post("./check_timezone.php",{timezone:$(this).val()},function(t){t.success?$(".btn-primary").prop("disabled",!1):($(e).addClass("has-error"),$("#timezone").next(".select2-container").addClass("has-error"),$("#sub_container").prepend(t.msg),$(".btn-primary").prop("disabled",!0)),$("#spinner-content").hide()},"JSON")})),$("#submit_update").on("click",function(e){e.preventDefault(),checkBeforeSubmit(need_update)}),$(".update_core").on("click",function(){var e=$(this);$(".btn").prop("disabled","disabled"),$(".text").hide(),$(".spinner-content").show(),$.post({url:"./update_core.php",dataType:"json",success(t){$(".btn").prop("disabled",""),$(".text").show(),$(".spinner-content").hide(),t.msg&&($("#resultDiv").show().html(t.msg),$(".errorDiv").hide().html(""),e.parent().parent().remove(),need_update=!1),t.err&&($(".errorDiv").show().html(t.err),$("#resultDiv").hide().html(""),$("#loading").attr("src","images/cross_arrow.png"))}})}),$("#timezone").select2(),$("#timezone").next(".select2-container").addClass("has-error")});
